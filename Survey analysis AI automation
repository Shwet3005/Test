{
  "cells": [
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "id": "vDT4JTSd6f3o"
      },
      "outputs": [],
      "source": [
        "# ============================================================================\n",
        "#  Install dependencies\n",
        "# ============================================================================\n",
        "\n",
        "!pip install pandas openpyxl tiktoken -q"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "id": "ebB7ux1chXa2"
      },
      "outputs": [],
      "source": [
        "# ============================================================================\n",
        "# suggestions\n",
        "# ============================================================================\n",
        "\n",
        "#constants/parameters cell\n",
        "#color the header column, and increse the column size\n",
        "\n",
        "#suggest own themes for categorisation during reiterating into prompt after 2-3 attempts\n",
        "#add theme columns next to respective questions\n",
        "#simple and grid questions are not getting generated in analysis, fix that\n",
        "#themes dict gets flushed out when reiterated for specific columns, it should get preserved for all\n",
        "\n",
        "#for na/empty/others, add categories, plus 3 examples in tables"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "id": "zDgFsTYdWbWM"
      },
      "outputs": [],
      "source": [
        "# ============================================================================\n",
        "# Import dependencies\n",
        "# ============================================================================\n",
        "\n",
        "import pandas as pd\n",
        "import numpy as np\n",
        "import json\n",
        "import tiktoken\n",
        "from google.colab import files\n",
        "from openai import OpenAI\n",
        "from collections import Counter\n",
        "import textwrap"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "kG64jBYJTh_V",
        "outputId": "d2dcbac1-252f-4029-f469-8e229061fc0e"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "✓ Constants and parameters loaded\n",
            "  Model: gpt-3.5-turbo\n",
            "  Num Themes to Extract: 5\n",
            "  Examples per Category: 3\n",
            "\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# CONSTANTS & PARAMETERS\n",
        "# ============================================================================\n",
        "\n",
        "API_KEY = \"",
        "MODEL = \"gpt-3.5-turbo\"  # Options: gpt-3.5-turbo, gpt-4o-mini, gpt-4o\n",
        "MODEL2 =  \"gpt-4o\"\n",
        "\n",
        "# Theme Extraction Parameters\n",
        "THEME_EXTRACTION_ATTEMPTS_THRESHOLD = 2\n",
        "NUM_THEMES_TO_EXTRACT = 5\n",
        "MIN_THEME_WORDS = 1\n",
        "MAX_THEME_WORDS = 3\n",
        "\n",
        "# Theme Assignment Parameters\n",
        "MAX_THEMES_PER_RESPONSE = 3\n",
        "THEME_ASSIGNMENT_TEMPERATURE = 0.1\n",
        "\n",
        "# Table Display Parameters\n",
        "NA_CATEGORY = \"No specific response\"\n",
        "EMPTY_CATEGORY = \"Empty response\"\n",
        "OTHERS_CATEGORY = \"Other themes\"\n",
        "NUM_EXAMPLES_PER_CATEGORY = 3\n",
        "MAX_CATEGORY_LENGTH = 60\n",
        "TABLE_SEPARATOR_LENGTH = 90\n",
        "\n",
        "# Excel Parameters\n",
        "HEADER_COLOR = \"4472C4\"\n",
        "SUBHEADER_COLOR = \"5B8FDE\"\n",
        "TOTAL_COLOR = \"D9E1F2\"\n",
        "MAX_COLUMN_WIDTH = 100\n",
        "MIN_COLUMN_WIDTH = 15\n",
        "\n",
        "# Classification Parameters\n",
        "UNIQUE_VALUES_THRESHOLD = 15\n",
        "AVG_LENGTH_THRESHOLD = 80\n",
        "\n",
        "print(\"✓ Constants and parameters loaded\")\n",
        "print(f\"  Model: {MODEL}\")\n",
        "print(f\"  Num Themes to Extract: {NUM_THEMES_TO_EXTRACT}\")\n",
        "print(f\"  Examples per Category: {NUM_EXAMPLES_PER_CATEGORY}\\n\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "id": "7iA6c93_CtIv"
      },
      "outputs": [],
      "source": [
        "# ============================================================================\n",
        "# Cost tracker\n",
        "# ============================================================================\n",
        "\n",
        "class CostTracker:\n",
        "    \"\"\"Track OpenAI API usage and costs by operation and question\"\"\"\n",
        "\n",
        "    MODELS = {\n",
        "        'gpt-3.5-turbo': {'input': 0.50, 'output': 1.50},\n",
        "        'gpt-4o-mini': {'input': 0.15, 'output': 0.60},\n",
        "        'gpt-4o': {'input': 5.00, 'output': 15.00}\n",
        "    }\n",
        "\n",
        "    def __init__(self):\n",
        "        self.calls = []\n",
        "        self.encoders = {}\n",
        "\n",
        "    def get_encoder(self, model):\n",
        "        if model not in self.encoders:\n",
        "            try:\n",
        "                self.encoders[model] = tiktoken.encoding_for_model(model)\n",
        "            except:\n",
        "                self.encoders[model] = tiktoken.get_encoding(\"cl100k_base\")\n",
        "        return self.encoders[model]\n",
        "\n",
        "    def count_tokens(self, text, model):\n",
        "        encoder = self.get_encoder(model)\n",
        "        return len(encoder.encode(text))\n",
        "\n",
        "    def log_call(self, model, prompt, response_text, operation=None, question=None):\n",
        "        input_tokens = self.count_tokens(prompt, model)\n",
        "        output_tokens = self.count_tokens(response_text, model)\n",
        "\n",
        "        pricing = self.MODELS[model]\n",
        "        input_cost = (input_tokens / 1_000_000) * pricing['input']\n",
        "        output_cost = (output_tokens / 1_000_000) * pricing['output']\n",
        "        total_cost = input_cost + output_cost\n",
        "\n",
        "        self.calls.append({\n",
        "            'model': model,\n",
        "            'input_tokens': input_tokens,\n",
        "            'output_tokens': output_tokens,\n",
        "            'total_tokens': input_tokens + output_tokens,\n",
        "            'cost': total_cost,\n",
        "            'operation': operation or 'Other',\n",
        "            'question': question or 'Unknown'\n",
        "        })\n",
        "\n",
        "        return total_cost\n",
        "\n",
        "    def summary(self):\n",
        "        if not self.calls:\n",
        "            print(\"\\n✓ No API calls made\\n\")\n",
        "            return\n",
        "\n",
        "        actual_model = self.calls[0]['model']\n",
        "        total_input = sum(c['input_tokens'] for c in self.calls)\n",
        "        total_output = sum(c['output_tokens'] for c in self.calls)\n",
        "\n",
        "        print(f\"\\n{'='*130}\")\n",
        "        print(\"API USAGE & COST SUMMARY (BY OPERATION)\")\n",
        "        print(f\"{'='*130}\")\n",
        "        print(f\"\\n✓ ACTUAL MODEL USED: {actual_model}\\n\")\n",
        "\n",
        "        operation_summary = {}\n",
        "        for call in self.calls:\n",
        "            op = call['operation']\n",
        "            if op not in operation_summary:\n",
        "                operation_summary[op] = {'input': 0, 'output': 0, 'cost': 0.0, 'count': 0}\n",
        "            operation_summary[op]['input'] += call['input_tokens']\n",
        "            operation_summary[op]['output'] += call['output_tokens']\n",
        "            operation_summary[op]['cost'] += call['cost']\n",
        "            operation_summary[op]['count'] += 1\n",
        "\n",
        "        print(f\"{'Operation':<40} | {'# Calls':<10} | {'Input Tokens':<15} | {'Output Tokens':<15} | {'Cost (USD)':<12}\")\n",
        "        print(\"-\" * 130)\n",
        "\n",
        "        for op, data in sorted(operation_summary.items()):\n",
        "            print(f\"{op:<40} | {data['count']:<10} | {data['input']:<15} | {data['output']:<15} | ${data['cost']:<11.6f}\")\n",
        "\n",
        "        total_calls = len(self.calls)\n",
        "        total_cost = sum(c['cost'] for c in self.calls)\n",
        "\n",
        "        print(\"-\" * 130)\n",
        "        print(f\"{'TOTAL':<40} | {total_calls:<10} | {total_input:<15} | {total_output:<15} | ${total_cost:<11.6f}\")\n",
        "        print(f\"{'='*130}\\n\")\n",
        "\n",
        "        print(f\"{'='*130}\")\n",
        "        print(\"PROJECTED COSTS FOR ALL MODELS (based on actual token usage)\")\n",
        "        print(f\"{'='*130}\")\n",
        "        print(f\"{'Model Name':<25} | {'Input ($/1M)':<15} | {'Output ($/1M)':<15} | {'Projected Cost':<15} | {'Status':<15}\")\n",
        "        print(\"-\" * 130)\n",
        "\n",
        "        for model_name in sorted(self.MODELS.keys()):\n",
        "            pricing = self.MODELS[model_name]\n",
        "            input_cost = (total_input / 1_000_000) * pricing['input']\n",
        "            output_cost = (total_output / 1_000_000) * pricing['output']\n",
        "            projected_total = input_cost + output_cost\n",
        "            status = \"✓ ACTUAL\" if model_name == actual_model else \"Projected\"\n",
        "\n",
        "            print(f\"{model_name:<25} | ${pricing['input']:<14.2f} | ${pricing['output']:<14.2f} | ${projected_total:<14.6f} | {status:<15}\")\n",
        "\n",
        "        print(f\"{'='*130}\\n\")\n",
        "\n",
        "    def summary_by_question(self):\n",
        "        if not self.calls:\n",
        "            print(\"\\n✓ No API calls made\\n\")\n",
        "            return\n",
        "\n",
        "        actual_model = self.calls[0]['model']\n",
        "        total_input = sum(c['input_tokens'] for c in self.calls)\n",
        "        total_output = sum(c['output_tokens'] for c in self.calls)\n",
        "\n",
        "        print(f\"\\n{'='*150}\")\n",
        "        print(\"API COST BREAKDOWN (BY QUESTION/COLUMN)\")\n",
        "        print(f\"{'='*150}\")\n",
        "        print(f\"\\n✓ ACTUAL MODEL USED: {actual_model}\\n\")\n",
        "\n",
        "        question_summary = {}\n",
        "        for call in self.calls:\n",
        "            q = call['question'][:80]\n",
        "            if q not in question_summary:\n",
        "                question_summary[q] = {'input': 0, 'output': 0, 'cost': 0.0, 'count': 0, 'operations': []}\n",
        "            question_summary[q]['input'] += call['input_tokens']\n",
        "            question_summary[q]['output'] += call['output_tokens']\n",
        "            question_summary[q]['cost'] += call['cost']\n",
        "            question_summary[q]['count'] += 1\n",
        "            if call['operation'] not in question_summary[q]['operations']:\n",
        "                question_summary[q]['operations'].append(call['operation'])\n",
        "\n",
        "        print(f\"{'Question/Column':<80} | {'Operations':<35} | {'# Calls':<8} | {'Input':<12} | {'Output':<12} | {'Cost (USD)':<12}\")\n",
        "        print(\"-\" * 150)\n",
        "\n",
        "        for q, data in sorted(question_summary.items()):\n",
        "            ops = ', '.join(data['operations'][:2])\n",
        "            if len(data['operations']) > 2:\n",
        "                ops += f\" +{len(data['operations'])-2}\"\n",
        "            print(f\"{q:<80} | {ops:<35} | {data['count']:<8} | {data['input']:<12} | {data['output']:<12} | ${data['cost']:<11.6f}\")\n",
        "\n",
        "        total_calls = len(self.calls)\n",
        "        total_cost = sum(c['cost'] for c in self.calls)\n",
        "\n",
        "        print(\"-\" * 150)\n",
        "        print(f\"{'TOTAL':<80} | {'':<35} | {total_calls:<8} | {total_input:<12} | {total_output:<12} | ${total_cost:<11.6f}\")\n",
        "        print(f\"{'='*150}\\n\")\n",
        "\n",
        "cost_tracker = CostTracker()"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 126
        },
        "id": "Ase0rwkV0QR_",
        "outputId": "1ea5d977-cdf0-4b69-8545-285211e47d78"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Upload your Excel file:\n"
          ]
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<IPython.core.display.HTML object>"
            ],
            "text/html": [
              "\n",
              "     <input type=\"file\" id=\"files-a07db65d-8a20-4861-825e-df9c9fa64ab1\" name=\"files[]\" multiple disabled\n",
              "        style=\"border:none\" />\n",
              "     <output id=\"result-a07db65d-8a20-4861-825e-df9c9fa64ab1\">\n",
              "      Upload widget is only available when the cell has been executed in the\n",
              "      current browser session. Please rerun this cell to enable.\n",
              "      </output>\n",
              "      <script>// Copyright 2017 Google LLC\n",
              "//\n",
              "// Licensed under the Apache License, Version 2.0 (the \"License\");\n",
              "// you may not use this file except in compliance with the License.\n",
              "// You may obtain a copy of the License at\n",
              "//\n",
              "//      http://www.apache.org/licenses/LICENSE-2.0\n",
              "//\n",
              "// Unless required by applicable law or agreed to in writing, software\n",
              "// distributed under the License is distributed on an \"AS IS\" BASIS,\n",
              "// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n",
              "// See the License for the specific language governing permissions and\n",
              "// limitations under the License.\n",
              "\n",
              "/**\n",
              " * @fileoverview Helpers for google.colab Python module.\n",
              " */\n",
              "(function(scope) {\n",
              "function span(text, styleAttributes = {}) {\n",
              "  const element = document.createElement('span');\n",
              "  element.textContent = text;\n",
              "  for (const key of Object.keys(styleAttributes)) {\n",
              "    element.style[key] = styleAttributes[key];\n",
              "  }\n",
              "  return element;\n",
              "}\n",
              "\n",
              "// Max number of bytes which will be uploaded at a time.\n",
              "const MAX_PAYLOAD_SIZE = 100 * 1024;\n",
              "\n",
              "function _uploadFiles(inputId, outputId) {\n",
              "  const steps = uploadFilesStep(inputId, outputId);\n",
              "  const outputElement = document.getElementById(outputId);\n",
              "  // Cache steps on the outputElement to make it available for the next call\n",
              "  // to uploadFilesContinue from Python.\n",
              "  outputElement.steps = steps;\n",
              "\n",
              "  return _uploadFilesContinue(outputId);\n",
              "}\n",
              "\n",
              "// This is roughly an async generator (not supported in the browser yet),\n",
              "// where there are multiple asynchronous steps and the Python side is going\n",
              "// to poll for completion of each step.\n",
              "// This uses a Promise to block the python side on completion of each step,\n",
              "// then passes the result of the previous step as the input to the next step.\n",
              "function _uploadFilesContinue(outputId) {\n",
              "  const outputElement = document.getElementById(outputId);\n",
              "  const steps = outputElement.steps;\n",
              "\n",
              "  const next = steps.next(outputElement.lastPromiseValue);\n",
              "  return Promise.resolve(next.value.promise).then((value) => {\n",
              "    // Cache the last promise value to make it available to the next\n",
              "    // step of the generator.\n",
              "    outputElement.lastPromiseValue = value;\n",
              "    return next.value.response;\n",
              "  });\n",
              "}\n",
              "\n",
              "/**\n",
              " * Generator function which is called between each async step of the upload\n",
              " * process.\n",
              " * @param {string} inputId Element ID of the input file picker element.\n",
              " * @param {string} outputId Element ID of the output display.\n",
              " * @return {!Iterable<!Object>} Iterable of next steps.\n",
              " */\n",
              "function* uploadFilesStep(inputId, outputId) {\n",
              "  const inputElement = document.getElementById(inputId);\n",
              "  inputElement.disabled = false;\n",
              "\n",
              "  const outputElement = document.getElementById(outputId);\n",
              "  outputElement.innerHTML = '';\n",
              "\n",
              "  const pickedPromise = new Promise((resolve) => {\n",
              "    inputElement.addEventListener('change', (e) => {\n",
              "      resolve(e.target.files);\n",
              "    });\n",
              "  });\n",
              "\n",
              "  const cancel = document.createElement('button');\n",
              "  inputElement.parentElement.appendChild(cancel);\n",
              "  cancel.textContent = 'Cancel upload';\n",
              "  const cancelPromise = new Promise((resolve) => {\n",
              "    cancel.onclick = () => {\n",
              "      resolve(null);\n",
              "    };\n",
              "  });\n",
              "\n",
              "  // Wait for the user to pick the files.\n",
              "  const files = yield {\n",
              "    promise: Promise.race([pickedPromise, cancelPromise]),\n",
              "    response: {\n",
              "      action: 'starting',\n",
              "    }\n",
              "  };\n",
              "\n",
              "  cancel.remove();\n",
              "\n",
              "  // Disable the input element since further picks are not allowed.\n",
              "  inputElement.disabled = true;\n",
              "\n",
              "  if (!files) {\n",
              "    return {\n",
              "      response: {\n",
              "        action: 'complete',\n",
              "      }\n",
              "    };\n",
              "  }\n",
              "\n",
              "  for (const file of files) {\n",
              "    const li = document.createElement('li');\n",
              "    li.append(span(file.name, {fontWeight: 'bold'}));\n",
              "    li.append(span(\n",
              "        `(${file.type || 'n/a'}) - ${file.size} bytes, ` +\n",
              "        `last modified: ${\n",
              "            file.lastModifiedDate ? file.lastModifiedDate.toLocaleDateString() :\n",
              "                                    'n/a'} - `));\n",
              "    const percent = span('0% done');\n",
              "    li.appendChild(percent);\n",
              "\n",
              "    outputElement.appendChild(li);\n",
              "\n",
              "    const fileDataPromise = new Promise((resolve) => {\n",
              "      const reader = new FileReader();\n",
              "      reader.onload = (e) => {\n",
              "        resolve(e.target.result);\n",
              "      };\n",
              "      reader.readAsArrayBuffer(file);\n",
              "    });\n",
              "    // Wait for the data to be ready.\n",
              "    let fileData = yield {\n",
              "      promise: fileDataPromise,\n",
              "      response: {\n",
              "        action: 'continue',\n",
              "      }\n",
              "    };\n",
              "\n",
              "    // Use a chunked sending to avoid message size limits. See b/62115660.\n",
              "    let position = 0;\n",
              "    do {\n",
              "      const length = Math.min(fileData.byteLength - position, MAX_PAYLOAD_SIZE);\n",
              "      const chunk = new Uint8Array(fileData, position, length);\n",
              "      position += length;\n",
              "\n",
              "      const base64 = btoa(String.fromCharCode.apply(null, chunk));\n",
              "      yield {\n",
              "        response: {\n",
              "          action: 'append',\n",
              "          file: file.name,\n",
              "          data: base64,\n",
              "        },\n",
              "      };\n",
              "\n",
              "      let percentDone = fileData.byteLength === 0 ?\n",
              "          100 :\n",
              "          Math.round((position / fileData.byteLength) * 100);\n",
              "      percent.textContent = `${percentDone}% done`;\n",
              "\n",
              "    } while (position < fileData.byteLength);\n",
              "  }\n",
              "\n",
              "  // All done.\n",
              "  yield {\n",
              "    response: {\n",
              "      action: 'complete',\n",
              "    }\n",
              "  };\n",
              "}\n",
              "\n",
              "scope.google = scope.google || {};\n",
              "scope.google.colab = scope.google.colab || {};\n",
              "scope.google.colab._files = {\n",
              "  _uploadFiles,\n",
              "  _uploadFilesContinue,\n",
              "};\n",
              "})(self);\n",
              "</script> "
            ]
          },
          "metadata": {}
        },
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Saving Programs Pulse Survey Jan'26.xlsx to Programs Pulse Survey Jan'26.xlsx\n",
            "File uploaded: Programs Pulse Survey Jan'26.xlsx\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# Upload Excel file\n",
        "# ============================================================================\n",
        "\n",
        "print(\"Upload your Excel file:\")\n",
        "uploaded = files.upload()\n",
        "file_name = list(uploaded.keys())[0]\n",
        "print(f\"File uploaded: {file_name}\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "3lw9JtNvTjx4",
        "outputId": "62500612-16c8-4844-f8fb-a4c22d6daa26"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "\n",
            "Available sheets: ['Form Responses 1']\n",
            "✓ Found: 'Form Responses 1'\n",
            "Using sheet: 'Form Responses 1'\n",
            "\n",
            "Loaded 62 responses, 11 columns\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# Load form responses\n",
        "# ============================================================================\n",
        "\n",
        "# Check available sheets and find Form Responses\n",
        "excel_file = pd.ExcelFile(file_name)\n",
        "print(f\"\\nAvailable sheets: {excel_file.sheet_names}\")\n",
        "\n",
        "# Find \"Form Responses\" tab (case-insensitive)\n",
        "form_responses_sheet = None\n",
        "for sheet in excel_file.sheet_names:\n",
        "    if 'form responses' in sheet.lower():\n",
        "        form_responses_sheet = sheet\n",
        "        break\n",
        "\n",
        "if form_responses_sheet:\n",
        "    print(f\"✓ Found: '{form_responses_sheet}'\")\n",
        "else:\n",
        "    print(\"⚠ 'Form Responses' sheet not found. Available sheets:\")\n",
        "    for i, sheet in enumerate(excel_file.sheet_names):\n",
        "        print(f\"  {i}: {sheet}\")\n",
        "    choice = input(\"Enter sheet number to use: \")\n",
        "    form_responses_sheet = excel_file.sheet_names[int(choice)]\n",
        "\n",
        "print(f\"Using sheet: '{form_responses_sheet}'\")\n",
        "\n",
        "# Load data and remove completely empty rows\n",
        "df = pd.read_excel(file_name, sheet_name=form_responses_sheet)\n",
        "\n",
        "# Remove rows where all values are NaN\n",
        "df = df.dropna(how='all')\n",
        "\n",
        "print(f\"\\nLoaded {df.shape[0]} responses, {df.shape[1]} columns\")\n",
        "\n",
        "# ============================================================================\n",
        "# Initialize themes_dict for current file\n",
        "# ============================================================================\n",
        "\n",
        "themes_dict = {}"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 1000
        },
        "id": "zjNn55ZEfdb9",
        "outputId": "966217f5-c25d-4bdf-d51e-61d3eaa4c570"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "                 Timestamp  SP ID:  \\\n",
              "0  2026-01-11 10:05:18.633  322920   \n",
              "1  2026-01-11 10:06:54.078  457495   \n",
              "2  2026-01-11 10:07:54.682  392371   \n",
              "3  2026-01-11 10:08:14.621  320190   \n",
              "4  2026-01-11 10:09:44.906  443004   \n",
              "..                     ...     ...   \n",
              "57 2026-01-14 08:23:08.161  450118   \n",
              "58 2026-01-15 16:55:36.400  374864   \n",
              "59 2026-01-15 18:48:10.762  324979   \n",
              "60 2026-01-16 11:35:11.792  336951   \n",
              "61 2026-01-17 22:32:57.094  343882   \n",
              "\n",
              "   How supportive did you find the following sessions of the monthly meeting? [Weekly parameter question - 'Seeing the best in people']  \\\n",
              "0                                    Somewhat helpful                                                                                     \n",
              "1                                    Somewhat helpful                                                                                     \n",
              "2                                   Extremely helpful                                                                                     \n",
              "3                                   Extremely helpful                                                                                     \n",
              "4                                   Extremely helpful                                                                                     \n",
              "..                                                ...                                                                                     \n",
              "57                                  Extremely helpful                                                                                     \n",
              "58                                  Extremely helpful                                                                                     \n",
              "59                                  Extremely helpful                                                                                     \n",
              "60                                  Extremely helpful                                                                                     \n",
              "61                                  Extremely helpful                                                                                     \n",
              "\n",
              "   How supportive did you find the following sessions of the monthly meeting? [Sadhguru Videos]  \\\n",
              "0                                   Extremely helpful                                             \n",
              "1                                    Somewhat helpful                                             \n",
              "2                                   Extremely helpful                                             \n",
              "3                                   Extremely helpful                                             \n",
              "4                                   Extremely helpful                                             \n",
              "..                                                ...                                             \n",
              "57                                  Extremely helpful                                             \n",
              "58                                  Extremely helpful                                             \n",
              "59                                  Extremely helpful                                             \n",
              "60                                  Extremely helpful                                             \n",
              "61                                  Extremely helpful                                             \n",
              "\n",
              "   How supportive did you find the following sessions of the monthly meeting? [Video conversation on 'Life after Sadhanapada' from SP alumni]  \\\n",
              "0                                    Somewhat helpful                                                                                           \n",
              "1                                             Neutral                                                                                           \n",
              "2                                   Extremely helpful                                                                                           \n",
              "3                                             Neutral                                                                                           \n",
              "4                                   Extremely helpful                                                                                           \n",
              "..                                                ...                                                                                           \n",
              "57                                  Extremely helpful                                                                                           \n",
              "58                                  Extremely helpful                                                                                           \n",
              "59                                   Somewhat helpful                                                                                           \n",
              "60                                  Extremely helpful                                                                                           \n",
              "61                                  Extremely helpful                                                                                           \n",
              "\n",
              "   How supportive did you find the following sessions of the monthly meeting? [Samyama meditation/Achala arpanam (whichever applicable)]  \\\n",
              "0                                   Extremely helpful                                                                                      \n",
              "1                                             Neutral                                                                                      \n",
              "2                                   Extremely helpful                                                                                      \n",
              "3                                             Neutral                                                                                      \n",
              "4                                   Extremely helpful                                                                                      \n",
              "..                                                ...                                                                                      \n",
              "57                                  Extremely helpful                                                                                      \n",
              "58                                  Extremely helpful                                                                                      \n",
              "59                                            Neutral                                                                                      \n",
              "60                                  Extremely helpful                                                                                      \n",
              "61                                  Extremely helpful                                                                                      \n",
              "\n",
              "   How supportive did you find the following sessions of the monthly meeting? [Guided meditation by Sadhguru]  \\\n",
              "0                                   Extremely helpful                                                           \n",
              "1                                             Neutral                                                           \n",
              "2                                   Extremely helpful                                                           \n",
              "3                                    Somewhat helpful                                                           \n",
              "4                                   Extremely helpful                                                           \n",
              "..                                                ...                                                           \n",
              "57                                  Extremely helpful                                                           \n",
              "58                                  Extremely helpful                                                           \n",
              "59                                  Extremely helpful                                                           \n",
              "60                                  Extremely helpful                                                           \n",
              "61                                  Extremely helpful                                                           \n",
              "\n",
              "   How supportive did you find the following sessions of the monthly meeting? [Start/Stop/Continue reflection session]  \\\n",
              "0                                    Somewhat helpful                                                                    \n",
              "1                                   Extremely helpful                                                                    \n",
              "2                                   Extremely helpful                                                                    \n",
              "3                                    Somewhat helpful                                                                    \n",
              "4                                   Extremely helpful                                                                    \n",
              "..                                                ...                                                                    \n",
              "57                                  Extremely helpful                                                                    \n",
              "58                                  Extremely helpful                                                                    \n",
              "59                                  Extremely helpful                                                                    \n",
              "60                                   Somewhat helpful                                                                    \n",
              "61                                  Extremely helpful                                                                    \n",
              "\n",
              "   What is one key takeaway you got from the monthly meeting session?  \\\n",
              "0                      Guided meditation by Sadhguru                    \n",
              "1                                                 NaN                   \n",
              "2   Sadhanapada doesn't end with this program it's...                   \n",
              "3   Made me think more about life after Sadhanapad...                   \n",
              "4   See good in people and don't judge them how th...                   \n",
              "..                                                ...                   \n",
              "57                                                NaN                   \n",
              "58                                                NaN                   \n",
              "59  Sadhanapada will start afterthought program ends                    \n",
              "60                                                NaN                   \n",
              "61                                                NaN                   \n",
              "\n",
              "   What is one suggestion you have for the monthly meeting  Email Address  \n",
              "0                                                 NaN                 NaN  \n",
              "1                                                 NaN                 NaN  \n",
              "2                                                 NaN                 NaN  \n",
              "3                                                 NaN                 NaN  \n",
              "4                                            Nothing                  NaN  \n",
              "..                                                ...                 ...  \n",
              "57                                                NaN                 NaN  \n",
              "58                                                NaN                 NaN  \n",
              "59  Clearly saying how much time we have for sadha...                 NaN  \n",
              "60                                                NaN                 NaN  \n",
              "61                                                NaN                 NaN  \n",
              "\n",
              "[62 rows x 11 columns]"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-6ffaf929-ecab-495a-bd0c-585138c1e829\" class=\"colab-df-container\">\n",
              "    <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>Timestamp</th>\n",
              "      <th>SP ID:</th>\n",
              "      <th>How supportive did you find the following sessions of the monthly meeting? [Weekly parameter question - 'Seeing the best in people']</th>\n",
              "      <th>How supportive did you find the following sessions of the monthly meeting? [Sadhguru Videos]</th>\n",
              "      <th>How supportive did you find the following sessions of the monthly meeting? [Video conversation on 'Life after Sadhanapada' from SP alumni]</th>\n",
              "      <th>How supportive did you find the following sessions of the monthly meeting? [Samyama meditation/Achala arpanam (whichever applicable)]</th>\n",
              "      <th>How supportive did you find the following sessions of the monthly meeting? [Guided meditation by Sadhguru]</th>\n",
              "      <th>How supportive did you find the following sessions of the monthly meeting? [Start/Stop/Continue reflection session]</th>\n",
              "      <th>What is one key takeaway you got from the monthly meeting session?</th>\n",
              "      <th>What is one suggestion you have for the monthly meeting</th>\n",
              "      <th>Email Address</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>2026-01-11 10:05:18.633</td>\n",
              "      <td>322920</td>\n",
              "      <td>Somewhat helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Somewhat helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Somewhat helpful</td>\n",
              "      <td>Guided meditation by Sadhguru</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>2026-01-11 10:06:54.078</td>\n",
              "      <td>457495</td>\n",
              "      <td>Somewhat helpful</td>\n",
              "      <td>Somewhat helpful</td>\n",
              "      <td>Neutral</td>\n",
              "      <td>Neutral</td>\n",
              "      <td>Neutral</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>2026-01-11 10:07:54.682</td>\n",
              "      <td>392371</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Sadhanapada doesn't end with this program it's...</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>2026-01-11 10:08:14.621</td>\n",
              "      <td>320190</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Neutral</td>\n",
              "      <td>Neutral</td>\n",
              "      <td>Somewhat helpful</td>\n",
              "      <td>Somewhat helpful</td>\n",
              "      <td>Made me think more about life after Sadhanapad...</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>2026-01-11 10:09:44.906</td>\n",
              "      <td>443004</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>See good in people and don't judge them how th...</td>\n",
              "      <td>Nothing</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>...</th>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>57</th>\n",
              "      <td>2026-01-14 08:23:08.161</td>\n",
              "      <td>450118</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>58</th>\n",
              "      <td>2026-01-15 16:55:36.400</td>\n",
              "      <td>374864</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>59</th>\n",
              "      <td>2026-01-15 18:48:10.762</td>\n",
              "      <td>324979</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Somewhat helpful</td>\n",
              "      <td>Neutral</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Sadhanapada will start afterthought program ends</td>\n",
              "      <td>Clearly saying how much time we have for sadha...</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>60</th>\n",
              "      <td>2026-01-16 11:35:11.792</td>\n",
              "      <td>336951</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Somewhat helpful</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>61</th>\n",
              "      <td>2026-01-17 22:32:57.094</td>\n",
              "      <td>343882</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>Extremely helpful</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "<p>62 rows × 11 columns</p>\n",
              "</div>\n",
              "    <div class=\"colab-df-buttons\">\n",
              "\n",
              "  <div class=\"colab-df-container\">\n",
              "    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-6ffaf929-ecab-495a-bd0c-585138c1e829')\"\n",
              "            title=\"Convert this dataframe to an interactive table.\"\n",
              "            style=\"display:none;\">\n",
              "\n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n",
              "    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n",
              "  </svg>\n",
              "    </button>\n",
              "\n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    .colab-df-buttons div {\n",
              "      margin-bottom: 4px;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "    <script>\n",
              "      const buttonEl =\n",
              "        document.querySelector('#df-6ffaf929-ecab-495a-bd0c-585138c1e829 button.colab-df-convert');\n",
              "      buttonEl.style.display =\n",
              "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "      async function convertToInteractive(key) {\n",
              "        const element = document.querySelector('#df-6ffaf929-ecab-495a-bd0c-585138c1e829');\n",
              "        const dataTable =\n",
              "          await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                    [key], {});\n",
              "        if (!dataTable) return;\n",
              "\n",
              "        const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "          + ' to learn more about interactive tables.';\n",
              "        element.innerHTML = '';\n",
              "        dataTable['output_type'] = 'display_data';\n",
              "        await google.colab.output.renderOutput(dataTable, element);\n",
              "        const docLink = document.createElement('div');\n",
              "        docLink.innerHTML = docLinkHtml;\n",
              "        element.appendChild(docLink);\n",
              "      }\n",
              "    </script>\n",
              "  </div>\n",
              "\n",
              "\n",
              "  <div id=\"id_9f28c931-8f0e-4884-b674-ccde9c251cb3\">\n",
              "    <style>\n",
              "      .colab-df-generate {\n",
              "        background-color: #E8F0FE;\n",
              "        border: none;\n",
              "        border-radius: 50%;\n",
              "        cursor: pointer;\n",
              "        display: none;\n",
              "        fill: #1967D2;\n",
              "        height: 32px;\n",
              "        padding: 0 0 0 0;\n",
              "        width: 32px;\n",
              "      }\n",
              "\n",
              "      .colab-df-generate:hover {\n",
              "        background-color: #E2EBFA;\n",
              "        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "        fill: #174EA6;\n",
              "      }\n",
              "\n",
              "      [theme=dark] .colab-df-generate {\n",
              "        background-color: #3B4455;\n",
              "        fill: #D2E3FC;\n",
              "      }\n",
              "\n",
              "      [theme=dark] .colab-df-generate:hover {\n",
              "        background-color: #434B5C;\n",
              "        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "        fill: #FFFFFF;\n",
              "      }\n",
              "    </style>\n",
              "    <button class=\"colab-df-generate\" onclick=\"generateWithVariable('df')\"\n",
              "            title=\"Generate code using this dataframe.\"\n",
              "            style=\"display:none;\">\n",
              "\n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z\"/>\n",
              "  </svg>\n",
              "    </button>\n",
              "    <script>\n",
              "      (() => {\n",
              "      const buttonEl =\n",
              "        document.querySelector('#id_9f28c931-8f0e-4884-b674-ccde9c251cb3 button.colab-df-generate');\n",
              "      buttonEl.style.display =\n",
              "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "      buttonEl.onclick = () => {\n",
              "        google.colab.notebook.generateWithVariable('df');\n",
              "      }\n",
              "      })();\n",
              "    </script>\n",
              "  </div>\n",
              "\n",
              "    </div>\n",
              "  </div>\n"
            ],
            "application/vnd.google.colaboratory.intrinsic+json": {
              "type": "dataframe",
              "variable_name": "df",
              "summary": "{\n  \"name\": \"df\",\n  \"rows\": 62,\n  \"fields\": [\n    {\n      \"column\": \"Timestamp\",\n      \"properties\": {\n        \"dtype\": \"date\",\n        \"min\": \"2026-01-11 10:05:18.633000\",\n        \"max\": \"2026-01-17 22:32:57.094000\",\n        \"num_unique_values\": 62,\n        \"samples\": [\n          \"2026-01-13 16:13:51.510000\",\n          \"2026-01-13 22:54:12.205000\",\n          \"2026-01-11 10:05:18.633000\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"SP ID:\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 51046,\n        \"min\": 301570,\n        \"max\": 459041,\n        \"num_unique_values\": 62,\n        \"samples\": [\n          446686,\n          307697,\n          322920\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"How supportive did you find the following sessions of the monthly meeting? [Weekly parameter question - 'Seeing the best in people']\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 5,\n        \"samples\": [\n          \"Extremely helpful\",\n          \"Somewhat unhelpful\",\n          \"Neutral\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"How supportive did you find the following sessions of the monthly meeting? [Sadhguru Videos]\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 2,\n        \"samples\": [\n          \"Somewhat helpful\",\n          \"Extremely helpful\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"How supportive did you find the following sessions of the monthly meeting? [Video conversation on 'Life after Sadhanapada' from SP alumni]\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 4,\n        \"samples\": [\n          \"Neutral\",\n          \"Somewhat unhelpful\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"How supportive did you find the following sessions of the monthly meeting? [Samyama meditation/Achala arpanam (whichever applicable)]\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 3,\n        \"samples\": [\n          \"Extremely helpful\",\n          \"Neutral\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"How supportive did you find the following sessions of the monthly meeting? [Guided meditation by Sadhguru]\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 3,\n        \"samples\": [\n          \"Extremely helpful\",\n          \"Neutral\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"How supportive did you find the following sessions of the monthly meeting? [Start/Stop/Continue reflection session]\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 4,\n        \"samples\": [\n          \"Extremely helpful\",\n          \"Neutral\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"What is one key takeaway you got from the monthly meeting session?\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 50,\n        \"samples\": [\n          \"Being able to see the sweetness in people and only condemning people's quality. Life after SP interviews were so relatable. I enjoyed Samyama meditation practice\",\n          \"Life after sadhanapadha. Few questions got answered \"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"What is one suggestion you have for the monthly meeting\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 31,\n        \"samples\": [\n          \"More sadhguru videos\",\n          \"Be more interactive rather than longer session with more and more and more information\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"Email Address\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": null,\n        \"min\": null,\n        \"max\": null,\n        \"num_unique_values\": 0,\n        \"samples\": [],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"
            }
          },
          "metadata": {},
          "execution_count": 8
        }
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "SwsXRoSt0ViP",
        "outputId": "42a9c0ed-bf5e-4f48-bcfc-2ed26f2b3237"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "\n",
            "======================================================================================================================================================\n",
            "CLASSIFICATION RESULTS\n",
            "======================================================================================================================================================\n",
            "                                                                                                                                  Question        Type  Unique Values                                                                                                                                                                                              Sample Values\n",
            "                                                                                                                                 Timestamp  Open-ended             62                                                             2026-01-11 10:05:18.633000 | 2026-01-11 10:06:54.078000 | 2026-01-11 10:07:54.682000 | 2026-01-11 10:08:14.621000 | 2026-01-11 10:09:44.906000\n",
            "                                                                                                                                    SP ID:  Open-ended             62                                                                                                                                                                 322920 | 457495 | 392371 | 320190 | 443004\n",
            "      How supportive did you find the following sessions of the monthly meeting? [Weekly parameter question - 'Seeing the best in people'] Close-ended              5                                                                                                                   Somewhat helpful | Extremely helpful | Neutral | Not at all helpful | Somewhat unhelpful\n",
            "                                              How supportive did you find the following sessions of the monthly meeting? [Sadhguru Videos] Close-ended              2                                                                                                                                                                       Extremely helpful | Somewhat helpful\n",
            "How supportive did you find the following sessions of the monthly meeting? [Video conversation on 'Life after Sadhanapada' from SP alumni] Close-ended              4                                                                                                                                        Somewhat helpful | Neutral | Extremely helpful | Somewhat unhelpful\n",
            "     How supportive did you find the following sessions of the monthly meeting? [Samyama meditation/Achala arpanam (whichever applicable)] Close-ended              3                                                                                                                                                             Extremely helpful | Neutral | Somewhat helpful\n",
            "                                How supportive did you find the following sessions of the monthly meeting? [Guided meditation by Sadhguru] Close-ended              3                                                                                                                                                             Extremely helpful | Neutral | Somewhat helpful\n",
            "                       How supportive did you find the following sessions of the monthly meeting? [Start/Stop/Continue reflection session] Close-ended              4                                                                                                                                        Somewhat helpful | Extremely helpful | Somewhat unhelpful | Neutral\n",
            "                                                                        What is one key takeaway you got from the monthly meeting session?  Open-ended             50 Guided meditation by Sadhguru  | Sadhanapada doesn't end with this progra | Made me think more about life after Sadh | See good in people and don't judge them  | This monthly meeting give me a sense of \n",
            "                                                                                   What is one suggestion you have for the monthly meeting  Open-ended             31                                              Nothing  | I don't have any, namaskaram! | I dont want them to end here | All meeting la were well planned , and t | It was one of the best sessions. No sugg\n",
            "                                                                                                                             Email Address       Empty              0                                                                                                                                                                                                           \n",
            "\n",
            "======================================================================================================================================================\n",
            "SUMMARY\n",
            "======================================================================================================================================================\n",
            "Type\n",
            "Close-ended    6\n",
            "Open-ended     4\n",
            "Empty          1\n",
            "Name: count, dtype: int64\n",
            "\n",
            "Total questions: 11\n",
            "\n",
            "Results saved to: question_classifications.xlsx\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# Classify questions into open-ended, close-ended.\n",
        "# ============================================================================\n",
        "\n",
        "\n",
        "def classify_question(series):\n",
        "    \"\"\"Classify as Open-ended (>=15 unique or avg_length>80) or Close-ended\"\"\"\n",
        "    values = series.dropna()\n",
        "\n",
        "    if len(values) == 0:\n",
        "        return 'Empty', 0, []\n",
        "\n",
        "    unique_vals = values.unique()\n",
        "    unique_count = len(unique_vals)\n",
        "    avg_length = np.mean([len(str(v)) for v in unique_vals])\n",
        "    samples = list(unique_vals[:5])\n",
        "\n",
        "    if unique_count >= UNIQUE_VALUES_THRESHOLD or avg_length > AVG_LENGTH_THRESHOLD:\n",
        "        return 'Open-ended', unique_count, samples\n",
        "    else:\n",
        "        return 'Close-ended', unique_count, samples\n",
        "\n",
        "results = []\n",
        "for col in df.columns:\n",
        "    q_type, unique_count, samples = classify_question(df[col])\n",
        "    results.append({\n",
        "        'Question': col,\n",
        "        'Type': q_type,\n",
        "        'Unique Values': unique_count,\n",
        "        'Sample Values': ' | '.join([str(v)[:40] for v in samples])\n",
        "    })\n",
        "\n",
        "results_df = pd.DataFrame(results)\n",
        "\n",
        "print(\"\\n\" + \"=\"*150)\n",
        "print(\"CLASSIFICATION RESULTS\")\n",
        "print(\"=\"*150)\n",
        "print(results_df.to_string(index=False))\n",
        "\n",
        "summary = results_df['Type'].value_counts()\n",
        "print(f\"\\n{'='*150}\")\n",
        "print(\"SUMMARY\")\n",
        "print(f\"{'='*150}\")\n",
        "print(summary)\n",
        "print(f\"\\nTotal questions: {len(results_df)}\")\n",
        "\n",
        "results_df.to_excel('question_classifications.xlsx', index=False)\n",
        "print(f\"\\nResults saved to: question_classifications.xlsx\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "id": "kLl4mvaKnidM"
      },
      "outputs": [],
      "source": [
        "# ============================================================================\n",
        "# Setup OpenAI API\n",
        "# ============================================================================\n",
        "\n",
        "client = OpenAI(api_key=API_KEY)"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 1000
        },
        "id": "YLTzK4m1LncZ",
        "outputId": "9d38ac59-b9e5-425f-f85e-99ee303b5bd6"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "\n",
            "Found 4 open-ended columns\n",
            "After filtering metadata: 2 columns\n",
            "\n",
            "====================================================================================================\n",
            "Do you have an existing themes_dict JSON to load? (yes/no): no\n",
            "✓ Starting fresh theme extraction\n",
            "\n",
            "====================================================================================================\n",
            "\n",
            "Available columns for theme extraction:\n",
            "  0: What is one key takeaway you got from the monthly meeting session?\n",
            "  1: What is one suggestion you have for the monthly meeting\n",
            "\n",
            "Enter column numbers (comma-separated) or 'all': all\n",
            "\n",
            "====================================================================================================\n",
            "Processing: What is one key takeaway you got from the monthly meeting session?\n",
            "Progress: 1/2\n",
            "====================================================================================================\n",
            "\n",
            "Total responses: 50\n",
            "Unique responses: 50\n",
            "\n",
            "No high-frequency themes found.\n",
            "\n",
            "✓ Extracted themes (Attempt 1): ['Guided Meditation', 'Life After Sadhanapada', 'Seeing The Best In People', 'Start/Stop/Continue Reflection', 'Samyama Practice']\n",
            "\n",
            "Extracting more themes...\n",
            "\n",
            "✓ Extracted themes (Attempt 2): ['Sense Of Urgency', 'Alumni Influence', 'Bhakti And Shakti', 'Stillness And Reflection', 'Sadhguru Teachings']\n",
            "\n",
            "✓ Currently retained themes (0):\n",
            "\n",
            "Available new themes from extraction:\n",
            "  0: Alumni Influence\n",
            "  1: Bhakti And Shakti\n",
            "  2: Guided Meditation\n",
            "  3: Life After Sadhanapada\n",
            "  4: Sadhguru Teachings\n",
            "  5: Samyama Practice\n",
            "  6: Seeing The Best In People\n",
            "  7: Sense Of Urgency\n",
            "  8: Start/Stop/Continue Reflection\n",
            "  9: Stillness And Reflection\n",
            "\n",
            "Target: 5 themes | Current: 0 themes | Remaining: 5\n",
            "\n",
            "====================================================================================================\n",
            "OPTIONS:\n",
            "  • Enter numbers (e.g., '0,2,3') to add themes\n",
            "  • 'skip' to retry extraction\n",
            "  • 'done' to finalize with current themes\n",
            "====================================================================================================\n",
            "\n",
            "▶ Enter your selection: 3, 5\n",
            "\n",
            "✓ Retained themes: ['Life After Sadhanapada', 'Samyama Practice']\n",
            "\n",
            "▶ Any feedback for next extraction? (or press Enter to continue): \n",
            "\n",
            "Will extract 3 more theme(s) in next attempt...\n",
            "\n",
            "✓ Extracted themes (Attempt 3): ['Program Conclusion', 'Personal Transformation', 'Self-Reflection Tools']\n",
            "\n",
            "✓ Currently retained themes (2):\n",
            "  1. Life After Sadhanapada\n",
            "  2. Samyama Practice\n",
            "\n",
            "Available new themes from extraction:\n",
            "  0: Alumni Influence\n",
            "  1: Bhakti And Shakti\n",
            "  2: Guided Meditation\n",
            "  3: Personal Transformation\n",
            "  4: Program Conclusion\n",
            "  5: Sadhguru Teachings\n",
            "  6: Seeing The Best In People\n",
            "  7: Self-Reflection Tools\n",
            "  8: Sense Of Urgency\n",
            "  9: Start/Stop/Continue Reflection\n",
            "  10: Stillness And Reflection\n",
            "\n",
            "Target: 5 themes | Current: 2 themes | Remaining: 3\n",
            "\n",
            "====================================================================================================\n",
            "OPTIONS:\n",
            "  • Enter numbers (e.g., '0,2,3') to add themes\n",
            "  • 'skip' to retry extraction\n",
            "  • 'done' to finalize with current themes\n",
            "====================================================================================================\n",
            "\n",
            "▶ Enter your selection: 2, 10, 0\n",
            "\n",
            "✓ Retained themes: ['Life After Sadhanapada', 'Samyama Practice', 'Guided Meditation', 'Stillness And Reflection', 'Alumni Influence']\n",
            "\n",
            "✓ Target of 5 themes reached!\n",
            "\n",
            "▶ Any feedback for potential next extraction? (or press Enter to skip): \n",
            "\n",
            "▶ Increase target? Enter number to add (or press Enter to finish): \n",
            "\n",
            "✓ Detected question type: open-ended\n",
            "✓ Assignment rule: Multiple themes allowed per response\n",
            "\n",
            "Override type? Enter 'likert-scale' or 'open-ended' or press Enter to keep 'open-ended': \n",
            "✓ Saved 5 themes for: What is one key takeaway you got from the monthly meeting session?\n",
            "\n",
            "\n",
            "====================================================================================================\n",
            "Processing: What is one suggestion you have for the monthly meeting\n",
            "Progress: 2/2\n",
            "====================================================================================================\n",
            "\n",
            "Total responses: 34\n",
            "Unique responses: 31\n",
            "\n",
            "High-frequency themes (≥5% occurrence):\n",
            "  0: 'Nothing' - 5 times (14.7%)\n",
            "\n",
            "Use these frequency themes? Enter numbers (e.g., '0,1') or 'all' or 'skip': 0\n",
            "✓ Selected 1 frequency themes: ['Nothing']\n",
            "\n",
            "✓ Extracted themes (Attempt 1): ['Session Length', 'Engagement Improvement', 'Additional Resources', 'Content Feedback']\n",
            "\n",
            "Extracting more themes...\n",
            "\n",
            "✓ Extracted themes (Attempt 2): ['Meeting Frequency', 'Post-Meal Drowsiness', 'Interactive Elements', 'Sadhana Focus']\n",
            "\n",
            "✓ Currently retained themes (1):\n",
            "  1. Nothing\n",
            "\n",
            "Available new themes from extraction:\n",
            "  0: Additional Resources\n",
            "  1: Content Feedback\n",
            "  2: Engagement Improvement\n",
            "  3: Interactive Elements\n",
            "  4: Meeting Frequency\n",
            "  5: Post-Meal Drowsiness\n",
            "  6: Sadhana Focus\n",
            "  7: Session Length\n",
            "\n",
            "Target: 5 themes | Current: 1 themes | Remaining: 4\n",
            "\n",
            "====================================================================================================\n",
            "OPTIONS:\n",
            "  • Enter numbers (e.g., '0,2,3') to add themes\n",
            "  • 'skip' to retry extraction\n",
            "  • 'done' to finalize with current themes\n",
            "====================================================================================================\n",
            "\n",
            "▶ Enter your selection: 4, 6, 1, 7\n",
            "\n",
            "✓ Retained themes: ['Nothing', 'Meeting Frequency', 'Sadhana Focus', 'Content Feedback', 'Session Length']\n",
            "\n",
            "✓ Target of 5 themes reached!\n",
            "\n",
            "▶ Any feedback for potential next extraction? (or press Enter to skip): \n",
            "\n",
            "▶ Increase target? Enter number to add (or press Enter to finish): \n",
            "\n",
            "✓ Detected question type: open-ended\n",
            "✓ Assignment rule: Multiple themes allowed per response\n",
            "\n",
            "Override type? Enter 'likert-scale' or 'open-ended' or press Enter to keep 'open-ended': \n",
            "✓ Saved 5 themes for: What is one suggestion you have for the monthly meeting\n",
            "\n",
            "\n",
            "====================================================================================================\n",
            "✓ Theme extraction completed for 2 columns\n",
            "====================================================================================================\n",
            "\n",
            "====================================================================================================\n",
            "Save themes_dict to JSON file? (yes/no): yes\n",
            "✓ Saved to themes_dict_structured.json\n"
          ]
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<IPython.core.display.Javascript object>"
            ],
            "application/javascript": [
              "\n",
              "    async function download(id, filename, size) {\n",
              "      if (!google.colab.kernel.accessAllowed) {\n",
              "        return;\n",
              "      }\n",
              "      const div = document.createElement('div');\n",
              "      const label = document.createElement('label');\n",
              "      label.textContent = `Downloading \"${filename}\": `;\n",
              "      div.appendChild(label);\n",
              "      const progress = document.createElement('progress');\n",
              "      progress.max = size;\n",
              "      div.appendChild(progress);\n",
              "      document.body.appendChild(div);\n",
              "\n",
              "      const buffers = [];\n",
              "      let downloaded = 0;\n",
              "\n",
              "      const channel = await google.colab.kernel.comms.open(id);\n",
              "      // Send a message to notify the kernel that we're ready.\n",
              "      channel.send({})\n",
              "\n",
              "      for await (const message of channel.messages) {\n",
              "        // Send a message to notify the kernel that we're ready.\n",
              "        channel.send({})\n",
              "        if (message.buffers) {\n",
              "          for (const buffer of message.buffers) {\n",
              "            buffers.push(buffer);\n",
              "            downloaded += buffer.byteLength;\n",
              "            progress.value = downloaded;\n",
              "          }\n",
              "        }\n",
              "      }\n",
              "      const blob = new Blob(buffers, {type: 'application/binary'});\n",
              "      const a = document.createElement('a');\n",
              "      a.href = window.URL.createObjectURL(blob);\n",
              "      a.download = filename;\n",
              "      div.appendChild(a);\n",
              "      a.click();\n",
              "      div.remove();\n",
              "    }\n",
              "  "
            ]
          },
          "metadata": {}
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<IPython.core.display.Javascript object>"
            ],
            "application/javascript": [
              "download(\"download_34d49f75-a224-4b44-ae0b-21bf0a9818aa\", \"themes_dict_structured.json\", 505)"
            ]
          },
          "metadata": {}
        },
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "✓ Downloaded themes_dict_structured.json\n",
            "\n",
            "====================================================================================================\n"
          ]
        }
      ],
      "source": [
        "from collections import Counter\n",
        "import re\n",
        "import json\n",
        "from typing import List, Tuple, Set\n",
        "\n",
        "def extract_frequency_themes(responses: List[str], frequency_threshold: float = 0.05) -> List[Tuple[str, int]]:\n",
        "    \"\"\"\n",
        "    Extract themes based purely on frequency of occurrence.\n",
        "    Returns themes that appear in at least 'frequency_threshold' % of responses.\n",
        "    Normalizes responses for duplicate detection.\n",
        "    \"\"\"\n",
        "    total = len(responses)\n",
        "\n",
        "    # Normalize responses FIRST, then count\n",
        "    normalized_responses = []\n",
        "    for r in responses:\n",
        "        r_clean = r.strip().lower()\n",
        "        if r_clean:  # Only check if not empty\n",
        "            normalized_responses.append(r_clean)\n",
        "\n",
        "    freq_counter = Counter(normalized_responses)\n",
        "\n",
        "    frequency_themes = []\n",
        "    seen_normalized = set()\n",
        "\n",
        "    for response_normalized, count in freq_counter.most_common():\n",
        "        if response_normalized in seen_normalized:\n",
        "            continue\n",
        "\n",
        "        frequency_pct = (count / total) * 100\n",
        "        if frequency_pct >= frequency_threshold * 100:  # At least 5% by default\n",
        "            # Return with proper title case for display\n",
        "            response_display = response_normalized.title()\n",
        "            frequency_themes.append((response_display, count, frequency_pct))\n",
        "            seen_normalized.add(response_normalized)\n",
        "\n",
        "    return frequency_themes\n",
        "\n",
        "\n",
        "def normalize_themes(themes: List[str]) -> List[str]:\n",
        "    \"\"\"Normalize theme names to Title Case and remove duplicates.\"\"\"\n",
        "    normalized = []\n",
        "    seen = set()\n",
        "    for t in themes:\n",
        "        t_clean = t.strip().title()\n",
        "        t_lower = t_clean.lower()\n",
        "        if t_lower not in seen:\n",
        "            normalized.append(t_clean)\n",
        "            seen.add(t_lower)\n",
        "    return normalized\n",
        "\n",
        "\n",
        "def detect_question_type(question: str, themes: List[str]) -> str:\n",
        "    \"\"\"\n",
        "    Detect if question is likert-scale or open-ended.\n",
        "\n",
        "    Returns:\n",
        "        'likert-scale': Rating/agreement/frequency questions (only ONE theme per response)\n",
        "        'open-ended': Descriptive responses (multiple themes allowed)\n",
        "    \"\"\"\n",
        "    question_lower = question.lower()\n",
        "\n",
        "    # Likert indicators in question\n",
        "    likert_keywords = [\n",
        "        'able to', 'were you', 'did you', 'have you', 'how much',\n",
        "        'to what extent', 'do you agree', 'how often', 'rate',\n",
        "        'satisfied', 'likely', 'comfortable'\n",
        "    ]\n",
        "\n",
        "    # Likert indicators in themes\n",
        "    likert_themes = {\n",
        "        'yes', 'no', 'maybe', 'somewhat', 'partially', 'mostly',\n",
        "        'always', 'often', 'sometimes', 'rarely', 'never',\n",
        "        'strongly agree', 'agree', 'neutral', 'disagree', 'strongly disagree',\n",
        "        'very', 'quite', 'not really', 'not at all', 'to great extent',\n",
        "        'almost', 'tried best'\n",
        "    }\n",
        "\n",
        "    themes_lower = [t.lower() for t in themes]\n",
        "\n",
        "    # Check if question has likert keywords\n",
        "    has_likert_question = any(kw in question_lower for kw in likert_keywords)\n",
        "\n",
        "    # Check if themes match likert pattern\n",
        "    likert_theme_matches = sum(1 for t in themes_lower if t in likert_themes)\n",
        "    has_likert_themes = likert_theme_matches >= len(themes) * 0.5  # 50% or more are likert\n",
        "\n",
        "    if has_likert_question and has_likert_themes:\n",
        "        return 'likert-scale'\n",
        "    else:\n",
        "        return 'open-ended'\n",
        "\n",
        "\n",
        "# Initialize themes_dict_structured with metadata\n",
        "if 'themes_dict_structured' not in globals():\n",
        "    themes_dict_structured = {}\n",
        "\n",
        "# EXTRACT THEMES FROM OPEN-ENDED WITH FREQUENCY-FIRST APPROACH\n",
        "# ============================================================================\n",
        "\n",
        "id_keywords = ['timestamp', 'email', 'name', 'sp id']\n",
        "open_ended_cols = results_df[results_df['Type'] == 'Open-ended']['Question'].tolist()\n",
        "filtered_cols = [col for col in open_ended_cols\n",
        "                 if not any(keyword.lower() in col.lower() for keyword in id_keywords)]\n",
        "\n",
        "print(f\"\\nFound {len(open_ended_cols)} open-ended columns\")\n",
        "print(f\"After filtering metadata: {len(filtered_cols)} columns\\n\")\n",
        "\n",
        "# ============================================================================\n",
        "# FEATURE 4: Import existing themes_dict JSON to skip already-themed questions\n",
        "# ============================================================================\n",
        "print(\"=\"*100)\n",
        "existing_themes = input(\"Do you have an existing themes_dict JSON to load? (yes/no): \").strip().lower()\n",
        "\n",
        "if existing_themes == 'yes':\n",
        "    print(\"\\nPaste your themes_dict JSON below (or press Enter to upload file):\")\n",
        "    print(\"Example JSON format:\")\n",
        "    print('''{\n",
        "  \"Question 1\": {\n",
        "    \"type\": \"open-ended\",\n",
        "    \"themes\": [\"Theme1\", \"Theme2\"]\n",
        "  },\n",
        "  \"Question 2\": {\n",
        "    \"type\": \"likert-scale\",\n",
        "    \"themes\": [\"Yes\", \"No\", \"Partially\"]\n",
        "  }\n",
        "}''')\n",
        "    print()\n",
        "\n",
        "    themes_input = input().strip()\n",
        "\n",
        "    if themes_input == '':\n",
        "        # Upload file\n",
        "        print(\"Please upload your themes_dict JSON file:\")\n",
        "        from google.colab import files\n",
        "        uploaded = files.upload()\n",
        "        if uploaded:\n",
        "            json_filename = list(uploaded.keys())[0]\n",
        "            with open(json_filename, 'r', encoding='utf-8') as f:\n",
        "                themes_input = f.read()\n",
        "\n",
        "    try:\n",
        "        imported_themes_dict = json.loads(themes_input)\n",
        "        if isinstance(imported_themes_dict, dict):\n",
        "            themes_dict_structured.update(imported_themes_dict)\n",
        "\n",
        "            # Also update old themes_dict for backward compatibility\n",
        "            for q, data in imported_themes_dict.items():\n",
        "                if isinstance(data, dict) and 'themes' in data:\n",
        "                    themes_dict[q] = data['themes']\n",
        "                elif isinstance(data, list):\n",
        "                    # Old format - convert to new format\n",
        "                    themes_dict[q] = data\n",
        "                    q_type = detect_question_type(q, data)\n",
        "                    themes_dict_structured[q] = {\n",
        "                        'type': q_type,\n",
        "                        'themes': data\n",
        "                    }\n",
        "\n",
        "            print(f\"\\n✓ Loaded {len(imported_themes_dict)} question(s) from themes_dict JSON\\n\")\n",
        "\n",
        "            # Show what was loaded with FULL questions\n",
        "            print(\"Loaded themes:\")\n",
        "            print(\"-\" * 100)\n",
        "            for q, data in themes_dict_structured.items():\n",
        "                themes = data['themes'] if isinstance(data, dict) else data\n",
        "                q_type = data.get('type', 'unknown') if isinstance(data, dict) else 'unknown'\n",
        "\n",
        "                print(f\"Q: {q}\")\n",
        "                print(f\"   Type: {q_type}\")\n",
        "                print(f\"   Themes: {', '.join(themes)}\")\n",
        "                print()\n",
        "\n",
        "            # Filter out already-themed columns\n",
        "            filtered_cols = [col for col in filtered_cols if col not in themes_dict]\n",
        "            print(f\"✓ {len(filtered_cols)} columns remaining for theme extraction\\n\")\n",
        "        else:\n",
        "            print(\"⚠ Invalid format. Proceeding without imported themes.\\n\")\n",
        "    except Exception as e:\n",
        "        print(f\"⚠ Failed to parse themes_dict: {e}\")\n",
        "        print(\"Proceeding without imported themes.\\n\")\n",
        "else:\n",
        "    print(\"✓ Starting fresh theme extraction\\n\")\n",
        "\n",
        "print(\"=\"*100 + \"\\n\")\n",
        "\n",
        "if len(filtered_cols) > 0:\n",
        "    print(\"Available columns for theme extraction:\")\n",
        "    for i, col in enumerate(filtered_cols):\n",
        "        print(f\"  {i}: {col}\")\n",
        "\n",
        "    selected_indices = input(\"\\nEnter column numbers (comma-separated) or 'all': \").strip()\n",
        "\n",
        "    if selected_indices.lower() == 'all' or selected_indices == '':\n",
        "        cols_to_process = filtered_cols\n",
        "    else:\n",
        "        try:\n",
        "            indices = [int(x.strip()) for x in selected_indices.split(\",\")]\n",
        "            cols_to_process = [filtered_cols[i] for i in indices if i < len(filtered_cols)]\n",
        "        except:\n",
        "            cols_to_process = filtered_cols\n",
        "\n",
        "    for col_idx, col in enumerate(cols_to_process):\n",
        "        print(f\"\\n{'='*100}\")\n",
        "        print(f\"Processing: {col}\")\n",
        "        print(f\"Progress: {col_idx + 1}/{len(cols_to_process)}\")\n",
        "        print(f\"{'='*100}\\n\")\n",
        "\n",
        "        all_responses = df[col].dropna().astype(str).tolist()\n",
        "        total_responses = len(all_responses)\n",
        "\n",
        "        # STEP 1: EXTRACT FREQUENCY-BASED THEMES\n",
        "        # ============================================================================\n",
        "        freq_themes = extract_frequency_themes(all_responses, frequency_threshold=0.05)\n",
        "\n",
        "        print(f\"Total responses: {total_responses}\")\n",
        "        print(f\"Unique responses: {len(set(all_responses))}\\n\")\n",
        "\n",
        "        # Show frequency themes and ask user if they want to use them\n",
        "        retained_themes = []\n",
        "        if freq_themes:\n",
        "            print(f\"High-frequency themes (≥5% occurrence):\")\n",
        "            for i, (theme, count, pct) in enumerate(freq_themes):\n",
        "                print(f\"  {i}: '{theme}' - {count} times ({pct:.1f}%)\")\n",
        "            print()\n",
        "\n",
        "            freq_choice = input(\"Use these frequency themes? Enter numbers (e.g., '0,1') or 'all' or 'skip': \").strip()\n",
        "\n",
        "            if freq_choice.lower() == 'all':\n",
        "                retained_themes = [t[0] for t in freq_themes]\n",
        "                print(f\"✓ Selected all {len(retained_themes)} frequency themes\\n\")\n",
        "            elif freq_choice.lower() == 'skip' or freq_choice == '':\n",
        "                print(\"✓ Skipped frequency themes\\n\")\n",
        "            else:\n",
        "                try:\n",
        "                    indices = [int(x.strip()) for x in freq_choice.split(\",\")]\n",
        "                    retained_themes = [freq_themes[i][0] for i in indices if i < len(freq_themes)]\n",
        "                    print(f\"✓ Selected {len(retained_themes)} frequency themes: {retained_themes}\\n\")\n",
        "                except:\n",
        "                    print(\"✓ Invalid input, skipping frequency themes\\n\")\n",
        "        else:\n",
        "            print(\"No high-frequency themes found.\\n\")\n",
        "\n",
        "        all_extracted_themes_across_attempts: Set[str] = set(retained_themes)\n",
        "\n",
        "        # STEP 2: AI-POWERED THEME EXTRACTION FOR REMAINING THEMES\n",
        "        # ============================================================================\n",
        "        satisfied_with_themes = False\n",
        "        attempts = 0\n",
        "        user_feedback_history = []\n",
        "        all_generated_themes_ever = set(retained_themes)\n",
        "        current_target = NUM_THEMES_TO_EXTRACT\n",
        "\n",
        "        while not satisfied_with_themes:\n",
        "            attempts += 1\n",
        "            themes_needed = current_target - len(retained_themes)\n",
        "\n",
        "            if themes_needed > 0:\n",
        "                retained_str = \"\\n\".join([f\"  - {t}\" for t in retained_themes]) if retained_themes else \"None\"\n",
        "                all_themes_to_avoid = sorted(list(all_generated_themes_ever))\n",
        "                avoid_str = \"\\n\".join([f\"  - {t}\" for t in all_themes_to_avoid])\n",
        "\n",
        "                feedback_context = \"\"\n",
        "                if user_feedback_history:\n",
        "                    feedback_context = \"\\n\\n🔴 CRITICAL USER FEEDBACK - FOLLOW THIS EXACTLY:\\n\"\n",
        "                    for i, feedback in enumerate(user_feedback_history, 1):\n",
        "                        feedback_context += f\"  {i}. {feedback}\\n\"\n",
        "                    feedback_context += \"\\nYou MUST incorporate this feedback. Generate DIFFERENT themes based on user guidance.\\n\"\n",
        "\n",
        "                prompt = f\"\"\"Analyze survey responses and extract {themes_needed} NEW themes.\n",
        "\n",
        "Question: {col}\n",
        "\n",
        "Already Retained Themes (DO NOT REPEAT): {retained_str}\n",
        "\n",
        "All Responses ({total_responses} total):\n",
        "{chr(10).join([f'{i+1}. {r}' for i, r in enumerate(all_responses)])}\n",
        "\n",
        "STEP 1 - DETECT PATTERN:\n",
        "Examine the question AND responses. Is this:\n",
        "A) LIKERT/RATING: Question asks about degree/extent/agreement/frequency. Responses are short (1-5 words) and form a spectrum.\n",
        "   Indicators: \"Yes/No\" in retained themes, question contains \"able to\"/\"were you\"/\"how much\"/\"to what extent\"\n",
        "B) OPEN-ENDED: Responses are descriptive paragraphs with explanations and varied content.\n",
        "\n",
        "STEP 2 - EXTRACT THEMES:\n",
        "\n",
        "IF PATTERN A (Likert/Rating):\n",
        "- Create {MIN_THEME_WORDS}-{MAX_THEME_WORDS} word rating categories that capture the SPECTRUM in responses\n",
        "- Think creatively about the scale: What intermediate levels exist between extremes?\n",
        "- Examples: \"Partially\", \"Mostly\", \"To Great Extent\", \"Somewhat\", \"Almost\"\n",
        "- Frequency themes already extracted: {[t[0] for t in freq_themes] if freq_themes else 'None'}\n",
        "- DO NOT repeat these frequency themes\n",
        "- Generate NEW rating categories based on response patterns\n",
        "\n",
        "IF PATTERN B (Open-ended):\n",
        "- Extract {MIN_THEME_WORDS}-{MAX_THEME_WORDS} word conceptual themes\n",
        "- Group similar ideas: \"Time Issues\", \"Resource Gaps\", \"Positive Experience\"\n",
        "\n",
        "🚫 AVOID ALL THESE (already retained or previously generated):\n",
        "{avoid_str}\n",
        "{feedback_context}\n",
        "Return ONLY a Python list:\n",
        "['theme1', 'theme2', ...]\"\"\"\n",
        "\n",
        "                response = client.chat.completions.create(\n",
        "                    model=MODEL2,\n",
        "                    messages=[{\"role\": \"user\", \"content\": prompt}],\n",
        "                    temperature=0.5,\n",
        "                )\n",
        "\n",
        "                response_text = response.choices[0].message.content.strip()\n",
        "\n",
        "                if response_text.startswith('```'):\n",
        "                    lines = response_text.split('\\n')\n",
        "                    if lines[0].strip().startswith('```'):\n",
        "                        lines = lines[1:]\n",
        "                    if lines and lines[-1].strip() == '```':\n",
        "                        lines = lines[:-1]\n",
        "                    response_text = '\\n'.join(lines).strip()\n",
        "\n",
        "                cost_tracker.log_call(MODEL2, prompt, response_text, operation=\"Extract Themes\", question=col)\n",
        "\n",
        "                try:\n",
        "                    new_themes = eval(response_text)\n",
        "                    if not isinstance(new_themes, list):\n",
        "                        new_themes = list(new_themes)\n",
        "\n",
        "                    new_themes = [str(t).strip() for t in new_themes[:themes_needed]]\n",
        "                    new_themes = normalize_themes(new_themes)\n",
        "\n",
        "                    all_generated_themes_ever.update(new_themes)\n",
        "\n",
        "                    retained_and_old_themes_lower = {t.lower() for t in all_generated_themes_ever if t not in new_themes}\n",
        "                    new_themes_filtered = [t for t in new_themes if t.lower() not in retained_and_old_themes_lower]\n",
        "\n",
        "                    if len(new_themes_filtered) < len(new_themes):\n",
        "                        removed_count = len(new_themes) - len(new_themes_filtered)\n",
        "                        print(f\"⚠ Removed {removed_count} theme(s) that were already generated before\\n\")\n",
        "\n",
        "                    new_themes = new_themes_filtered\n",
        "                    all_extracted_themes_across_attempts.update(new_themes)\n",
        "\n",
        "                    print(f\"✓ Extracted themes (Attempt {attempts}): {new_themes}\\n\")\n",
        "\n",
        "                    if attempts < THEME_EXTRACTION_ATTEMPTS_THRESHOLD:\n",
        "                        print(f\"Extracting more themes...\\n\")\n",
        "                    else:\n",
        "                        print(f\"✓ Currently retained themes ({len(retained_themes)}):\")\n",
        "                        for i, theme in enumerate(retained_themes, 1):\n",
        "                            print(f\"  {i}. {theme}\")\n",
        "\n",
        "                        available_themes = sorted(list(all_extracted_themes_across_attempts - set(retained_themes)))\n",
        "                        remaining_needed = current_target - len(retained_themes)\n",
        "\n",
        "                        print(f\"\\nAvailable new themes from extraction:\")\n",
        "                        if available_themes:\n",
        "                            for i, theme in enumerate(available_themes):\n",
        "                                print(f\"  {i}: {theme}\")\n",
        "                        else:\n",
        "                            print(\"  (No new themes available)\")\n",
        "\n",
        "                        print(f\"\\nTarget: {current_target} themes | Current: {len(retained_themes)} themes | Remaining: {remaining_needed}\")\n",
        "                        print(\"\\n\" + \"=\"*100)\n",
        "                        print(\"OPTIONS:\")\n",
        "                        print(\"  • Enter numbers (e.g., '0,2,3') to add themes\")\n",
        "                        print(\"  • 'skip' to retry extraction\")\n",
        "                        print(\"  • 'done' to finalize with current themes\")\n",
        "                        print(\"=\"*100 + \"\\n\")\n",
        "\n",
        "                        retained_input = input(f\"▶ Enter your selection: \").strip()\n",
        "\n",
        "                        if retained_input.lower() == 'done':\n",
        "                            final_themes = retained_themes\n",
        "                            if len(final_themes) < current_target:\n",
        "                                print(f\"\\n⚠ You have {len(final_themes)} theme(s), target was {current_target}\")\n",
        "                                confirm = input(\"Confirm finalization? (yes/no): \").strip().lower()\n",
        "                                if confirm != 'yes':\n",
        "                                    print(\"Continuing extraction...\\n\")\n",
        "                                    continue\n",
        "\n",
        "                            # Detect question type and save structured format\n",
        "                            q_type = detect_question_type(col, final_themes)\n",
        "\n",
        "                            print(f\"\\n✓ Detected question type: {q_type}\")\n",
        "                            if q_type == 'likert-scale':\n",
        "                                print(f\"✓ Assignment rule: ONE theme per response (most probable)\\n\")\n",
        "                            else:\n",
        "                                print(f\"✓ Assignment rule: Multiple themes allowed per response\\n\")\n",
        "\n",
        "                            # Ask user to confirm or override\n",
        "                            override = input(f\"Override type? Enter 'likert-scale' or 'open-ended' or press Enter to keep '{q_type}': \").strip()\n",
        "                            if override in ['likert-scale', 'open-ended']:\n",
        "                                q_type = override\n",
        "                                print(f\"✓ Updated to {q_type}\\n\")\n",
        "\n",
        "                            themes_dict[col] = final_themes\n",
        "                            themes_dict_structured[col] = {\n",
        "                                'type': q_type,\n",
        "                                'themes': final_themes\n",
        "                            }\n",
        "                            satisfied_with_themes = True\n",
        "                            print(f\"✓ Saved themes for: {col}\\n\")\n",
        "\n",
        "                        elif retained_input.lower() == 'skip':\n",
        "                            print()\n",
        "                            feedback = input(\"▶ Provide guidance for next extraction (or press Enter to skip): \").strip()\n",
        "                            if feedback:\n",
        "                                user_feedback_history.append(feedback)\n",
        "                                print(f\"✓ Feedback recorded: '{feedback}'\")\n",
        "                            print(\"Retrying extraction...\\n\")\n",
        "\n",
        "                        elif retained_input == '':\n",
        "                            print()\n",
        "                            feedback = input(\"▶ Provide guidance for next extraction (or press Enter to retry): \").strip()\n",
        "                            if feedback:\n",
        "                                user_feedback_history.append(feedback)\n",
        "                                print(f\"✓ Feedback recorded: '{feedback}'\")\n",
        "                            print(\"Retrying extraction...\\n\")\n",
        "\n",
        "                        else:\n",
        "                            try:\n",
        "                                indices = [int(x.strip()) for x in retained_input.split(\",\")]\n",
        "                                newly_retained = [available_themes[i] for i in indices if i < len(available_themes)]\n",
        "                                retained_themes.extend(newly_retained)\n",
        "                                retained_themes = list(dict.fromkeys(retained_themes))\n",
        "                                print(f\"\\n✓ Retained themes: {retained_themes}\")\n",
        "\n",
        "                                if len(retained_themes) >= current_target:\n",
        "                                    print(f\"\\n✓ Target of {current_target} themes reached!\")\n",
        "\n",
        "                                    print()\n",
        "                                    feedback = input(\"▶ Any feedback for potential next extraction? (or press Enter to skip): \").strip()\n",
        "                                    if feedback:\n",
        "                                        user_feedback_history.append(feedback)\n",
        "                                        print(f\"✓ Feedback recorded: '{feedback}'\")\n",
        "\n",
        "                                    print()\n",
        "                                    increase = input(\"▶ Increase target? Enter number to add (or press Enter to finish): \").strip()\n",
        "\n",
        "                                    if increase == '':\n",
        "                                        # Detect and save\n",
        "                                        q_type = detect_question_type(col, retained_themes)\n",
        "\n",
        "                                        print(f\"\\n✓ Detected question type: {q_type}\")\n",
        "                                        if q_type == 'likert-scale':\n",
        "                                            print(f\"✓ Assignment rule: ONE theme per response (most probable)\\n\")\n",
        "                                        else:\n",
        "                                            print(f\"✓ Assignment rule: Multiple themes allowed per response\\n\")\n",
        "\n",
        "                                        override = input(f\"Override type? Enter 'likert-scale' or 'open-ended' or press Enter to keep '{q_type}': \").strip()\n",
        "                                        if override in ['likert-scale', 'open-ended']:\n",
        "                                            q_type = override\n",
        "                                            print(f\"✓ Updated to {q_type}\\n\")\n",
        "\n",
        "                                        themes_dict[col] = retained_themes\n",
        "                                        themes_dict_structured[col] = {\n",
        "                                            'type': q_type,\n",
        "                                            'themes': retained_themes\n",
        "                                        }\n",
        "                                        satisfied_with_themes = True\n",
        "                                        print(f\"✓ Saved {len(retained_themes)} themes for: {col}\\n\")\n",
        "                                    else:\n",
        "                                        try:\n",
        "                                            add_count = int(increase)\n",
        "                                            current_target += add_count\n",
        "                                            print(f\"✓ Target increased to {current_target} themes\")\n",
        "                                            print(f\"Will extract {current_target - len(retained_themes)} more theme(s)...\\n\")\n",
        "                                        except:\n",
        "                                            print(\"Invalid number. Finalizing with current themes.\")\n",
        "                                            themes_dict[col] = retained_themes\n",
        "                                            satisfied_with_themes = True\n",
        "                                            print(f\"✓ Saved {len(retained_themes)} themes for: {col}\\n\")\n",
        "                                else:\n",
        "                                    print()\n",
        "                                    feedback = input(\"▶ Any feedback for next extraction? (or press Enter to continue): \").strip()\n",
        "                                    if feedback:\n",
        "                                        user_feedback_history.append(feedback)\n",
        "                                        print(f\"✓ Feedback recorded: '{feedback}'\")\n",
        "\n",
        "                                    updated_remaining = current_target - len(retained_themes)\n",
        "                                    print(f\"\\nWill extract {updated_remaining} more theme(s) in next attempt...\\n\")\n",
        "\n",
        "                            except:\n",
        "                                print(f\"⚠ Invalid input. Please enter numbers, 'skip', or 'done'\")\n",
        "                                print(\"Retrying...\\n\")\n",
        "\n",
        "                except Exception as e:\n",
        "                    print(f\"⚠ Failed to parse response: {response_text[:100]}...\")\n",
        "                    print(f\"Error: {e}\")\n",
        "                    print(\"Retrying...\\n\")\n",
        "\n",
        "            else:\n",
        "                # All themes obtained - detect type and save\n",
        "                q_type = detect_question_type(col, retained_themes)\n",
        "\n",
        "                print(f\"✓ All {current_target} themes have been selected:\")\n",
        "                for i, theme in enumerate(retained_themes, 1):\n",
        "                    print(f\"  {i}. {theme}\")\n",
        "\n",
        "                print(f\"\\n✓ Detected question type: {q_type}\")\n",
        "                if q_type == 'likert-scale':\n",
        "                    print(f\"✓ Assignment rule: ONE theme per response (most probable)\\n\")\n",
        "                else:\n",
        "                    print(f\"✓ Assignment rule: Multiple themes allowed per response\\n\")\n",
        "\n",
        "                override = input(f\"Override type? Enter 'likert-scale' or 'open-ended' or press Enter to keep '{q_type}': \").strip()\n",
        "                if override in ['likert-scale', 'open-ended']:\n",
        "                    q_type = override\n",
        "                    print(f\"✓ Updated to {q_type}\\n\")\n",
        "\n",
        "                themes_dict[col] = retained_themes\n",
        "                themes_dict_structured[col] = {\n",
        "                    'type': q_type,\n",
        "                    'themes': retained_themes\n",
        "                }\n",
        "                satisfied_with_themes = True\n",
        "                print(f\"✓ Saved themes for: {col}\\n\")\n",
        "\n",
        "    print(f\"\\n{'='*100}\")\n",
        "    print(f\"✓ Theme extraction completed for {len(themes_dict)} columns\")\n",
        "    print(f\"{'='*100}\\n\")\n",
        "\n",
        "    # Save themes_dict_structured to JSON\n",
        "    print(\"=\"*100)\n",
        "    save_themes = input(\"Save themes_dict to JSON file? (yes/no): \").strip().lower()\n",
        "    if save_themes == 'yes':\n",
        "        themes_filename = 'themes_dict_structured.json'\n",
        "        with open(themes_filename, 'w', encoding='utf-8') as f:\n",
        "            json.dump(themes_dict_structured, f, indent=2, ensure_ascii=False)\n",
        "        print(f\"✓ Saved to {themes_filename}\")\n",
        "        from google.colab import files\n",
        "        files.download(themes_filename)\n",
        "        print(f\"✓ Downloaded {themes_filename}\\n\")\n",
        "    print(\"=\"*100)\n",
        "\n",
        "else:\n",
        "    print(\"✓ All columns already have themes or no columns to process\\n\")"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [],
      "metadata": {
        "id": "F-KkCGeaoyIn"
      }
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "id": "d0OcmJIaiz1y"
      },
      "outputs": [],
      "source": [
        "# ============================================================================\n",
        "# Visualising themes\n",
        "# ============================================================================\n",
        "\n",
        "themes_dict = {'What is one key takeaway you got from the monthly meeting session?': [\n",
        "      \"Life After Sadhanapada\",\n",
        "      \"Samyama Practice\",\n",
        "      \"Guided Meditation\",\n",
        "      \"Stillness And Reflection\",\n",
        "      \"Alumni Influence\"\n",
        "    ],\n",
        " 'What is one suggestion you have for the monthly meeting': [\n",
        "      \"Nothing\",\n",
        "      \"Meeting Frequency\",\n",
        "      \"Sadhana Focus\",\n",
        "      \"Content Feedback\",\n",
        "      \"Session Length\"\n",
        "    ]}"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "themes_dict"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "_16zD2BA69Fn",
        "outputId": "89704e98-8e20-449a-e9d6-d7ec62309e96"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "{'What is one key takeaway you got from the monthly meeting session?': ['Life After Sadhanapada',\n",
              "  'Samyama Practice',\n",
              "  'Guided Meditation',\n",
              "  'Stillness And Reflection',\n",
              "  'Alumni Influence'],\n",
              " 'What is one suggestion you have for the monthly meeting': ['Nothing',\n",
              "  'Meeting Frequency',\n",
              "  'Sadhana Focus',\n",
              "  'Content Feedback',\n",
              "  'Session Length']}"
            ]
          },
          "metadata": {},
          "execution_count": 17
        }
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "ABCIlHeQqX5m",
        "outputId": "7847fd45-24d1-43b1-c2f9-4cfc7e048599"
      },
      "outputs": [
        {
          "name": "stdout",
          "output_type": "stream",
          "text": [
            "\n",
            "====================================================================================================\n",
            "ASSIGN THEMES TO ROWS\n",
            "====================================================================================================\n",
            "\n",
            "Processing: What is one key takeaway you got from the monthly meeting session?\n",
            "Available themes: ['Life After Sadhanapada', 'Samyama Practice', 'Guided Meditation', 'Stillness And Reflection', 'Alumni Influence']\n",
            "\n",
            "Row   | ID                   | Response                                                                    | Assigned Themes                                   \n",
            "----------------------------------------------------------------------------------------------------------------------------------------------------------------\n",
            "1     | 322920               | Guided meditation by Sadhguru                                               | Guided Meditation                                 \n",
            "2     | 457495               | [Empty]                                                                     | Empty response                                    \n",
            "3     | 392371               | Sadhanapada doesn't end with this program it's a life long process          | Life After Sadhanapada                            \n",
            "4     | 320190               | Made me think more about life after Sadhanapada in a practical sense.       | Life After Sadhanapada | Alumni Influence         \n",
            "      |                      | Especially when the Ex-army anna said Sadhanapada does not end with the     |                                                   \n",
            "      |                      | program during the Alumni discussion                                        |                                                   \n",
            "5     | 443004               | See good in people and don't judge them how they are behaving               | Stillness And Reflection                          \n",
            "6     | 447896               | This monthly meeting give me a sense of urgency, wich is good in a way      | Life After Sadhanapada | Stillness And Reflection \n",
            "      |                      | becouse gives me more energy and push me to push mylself more, I can't      |                                                   \n",
            "      |                      | believe 7 months passed fast like this! i need to give everything in this   |                                                   \n",
            "      |                      | last mandala!                                                               |                                                   \n",
            "7     | 436206               | Lesson from Shri Ram's life that Sadhguru shared with us about killing      | Life After Sadhanapada                            \n",
            "      |                      | Ravana                                                                      |                                                   \n",
            "8     | 398040               | [Empty]                                                                     | Empty response                                    \n",
            "9     | 390896               | Seeing best in people , loved the conversations as well with SP alumni ,    | Life After Sadhanapada | Alumni Influence         \n",
            "      |                      | feeling sad that the program is ending                                      |                                                   \n",
            "10    | 333412               | To continue seeing best in people.                                          | Stillness And Reflection                          \n",
            "11    | 453139               | Seing the best in people is not just about being non judgemental, but       | Stillness And Reflection | Life After Sadhanapada \n",
            "      |                      | also about making the higher possibilities prevelent all arround us.        |                                                   \n",
            "12    | 441985               | To look at people fresh as they are                                         | Stillness And Reflection                          \n",
            "13    | 440258               | I have to keep my prejudices away and see the best in people, and if I      | Life After Sadhanapada                            \n",
            "      |                      | learn to do that, I can reap the benefits of my sadhana during              |                                                   \n",
            "      |                      | kaivalyapada                                                                |                                                   \n",
            "14    | 344249               | Rekindle Samyama practice                                                   | Samyama Practice                                  \n",
            "15    | 445692               | Whatever we pay our attention to will grow, so we should select the best    | Stillness And Reflection                          \n",
            "      |                      | in people to look at                                                        |                                                   \n",
            "16    | 442653               | Being able to see the sweetness in people and only condemning people's      | Life After Sadhanapada | Samyama Practice         \n",
            "      |                      | quality. Life after SP interviews were so relatable. I enjoyed Samyama      |                                                   \n",
            "      |                      | meditation practice                                                         |                                                   \n",
            "17    | 382722               | how to carry on the pracxtices outside isha also, and stillness and just    | Life After Sadhanapada | Stillness And Reflection \n",
            "      |                      | how magical the montly parameters are.                                      |                                                   \n",
            "18    | 340785               | Life after sadhanapada is something that will challenge you! Look forward   | Life After Sadhanapada                            \n",
            "      |                      | to it                                                                       |                                                   \n",
            "19    | 353374               | Samyama Meditation                                                          | Samyama Practice                                  \n",
            "20    | 442555               | [Empty]                                                                     | Empty response                                    \n",
            "21    | 442946               | swamis word \"this is the last mandala\"                                      | Life After Sadhanapada | Other themes             \n",
            "22    | 443952               | Seeing the best in people and dropping all my conclusions this Pongal.      | Stillness And Reflection                          \n",
            "23    | 335260               | To see the best in people. This really helped me out in daily interaction   | Other themes                                      \n",
            "      |                      | with people.                                                                |                                                   \n",
            "24    | 366361               | One takeaway is to keep my sadhana on even after going back home and be     | Life After Sadhanapada                            \n",
            "      |                      | consistent with the practices. I have seen positive changes within me so    |                                                   \n",
            "      |                      | I know that these practices are going to be for life now.                   |                                                   \n",
            "25    | 355210               | Bhakti is the root of shakti.                                               | Other themes                                      \n",
            "26    | 393556               | Stillness                                                                   | Stillness And Reflection                          \n",
            "27    | 404845               | Start stop continue reflection                                              | Stillness And Reflection                          \n",
            "28    | 441142               | Start Stop and Continue that is something I needed and the fall back of     | Guided Meditation                                 \n",
            "      |                      | Guided session that Kind of stuck with me                                   |                                                   \n",
            "29    | 442715               | [Empty]                                                                     | Empty response                                    \n",
            "30    | 451983               | [Empty]                                                                     | Empty response                                    \n",
            "31    | 386972               | Start/Stop/Continue reflection session                                      | Stillness And Reflection                          \n",
            "32    | 441213               | This was the last monthly meeting, and I’m going to miss all the laughter   | Life After Sadhanapada | Alumni Influence         \n",
            "      |                      | we shared. Everything that happened during the meeting has become a key     |                                                   \n",
            "      |                      | takeaway for me.                                                            |                                                   \n",
            "33    | 395617               | Witnessing Samyama meditation as a possibility for my self                  | Samyama Practice                                  \n",
            "34    | 445161               | Parameter questions,  life after sadhanapada,  guided samyama practices     | Life After Sadhanapada | Samyama Practice | Guided Meditation\n",
            "35    | 442646               | Weekly parameters question                                                  | Other themes                                      \n",
            "36    | 459041               | Seeing the best in people                                                   | Other themes                                      \n",
            "37    | 455728               | Life after Sadhanapada                                                      | Life After Sadhanapada                            \n",
            "38    | 441900               | Seeing the best in the people                                               | Other themes                                      \n",
            "39    | 452667               | everything was ok for me                                                    | Other themes                                      \n",
            "40    | 443753               | Reality check after sadhanapada                                             | Life After Sadhanapada                            \n",
            "41    | 301570               | [Empty]                                                                     | Empty response                                    \n",
            "42    | 445452               | [Empty]                                                                     | Empty response                                    \n",
            "43    | 442716               | Sadhguru's videos                                                           | Other themes                                      \n",
            "44    | 303643               | life after sadhanapada from alumnis🙏                                        | Life After Sadhanapada | Alumni Influence         \n",
            "45    | 367076               | [Empty]                                                                     | Empty response                                    \n",
            "46    | 446780               | Start /Stop/Continue reflection                                             | Stillness And Reflection                          \n",
            "47    | 427868               | Seeing the best in people                                                   | Other themes                                      \n",
            "48    | 453147               | Life after sadhanapadha. Few questions got answered                         | Life After Sadhanapada                            \n",
            "49    | 413856               | I find inside what changes happened in last six month                       | Life After Sadhanapada                            \n",
            "50    | 457236               | Seeing the best in everyone' was a key takeaway for me, as I am always      | Stillness And Reflection                          \n",
            "      |                      | used to do that but sometimes i got hurt, but during session I have         |                                                   \n",
            "      |                      | realised that it has already gave me a strength.                            |                                                   \n",
            "51    | 446686               | See the best in people                                                      | Other themes                                      \n",
            "52    | 436220               | Trying to see best in people                                                | Other themes                                      \n",
            "53    | 354018               | Rose tree.                                                                  | Other themes                                      \n",
            "54    | 302035               | To see best in people                                                       | Stillness And Reflection                          \n",
            "55    | 366686               | Preparing for post sadhanapada                                              | Life After Sadhanapada                            \n",
            "56    | 350553               | Seeing the best in people is a tool that raises my awareness of what my     | Stillness And Reflection | Life After Sadhanapada \n",
            "      |                      | perception is in that moment and how I’m in control of my mind which,       |                                                   \n",
            "      |                      | when used to see the best, can open up the possibility of a different or    |                                                   \n",
            "      |                      | new perception.                                                             |                                                   \n",
            "57    | 307697               | Alumini speech                                                              | Alumni Influence                                  \n",
            "58    | 450118               | [Empty]                                                                     | Empty response                                    \n",
            "59    | 374864               | [Empty]                                                                     | Empty response                                    \n",
            "60    | 324979               | Sadhanapada will start afterthought program ends                            | Life After Sadhanapada                            \n",
            "61    | 336951               | [Empty]                                                                     | Empty response                                    \n",
            "62    | 343882               | [Empty]                                                                     | Empty response                                    \n",
            "----------------------------------------------------------------------------------------------------------------------------------------------------------------\n",
            "\n",
            "Satisfied with this assignment? (yes/no): yes\n",
            "Processing: What is one suggestion you have for the monthly meeting\n",
            "Available themes: ['Nothing', 'Meeting Frequency', 'Sadhana Focus', 'Content Feedback', 'Session Length']\n",
            "\n",
            "Row   | ID                   | Response                                                                    | Assigned Themes                                   \n",
            "----------------------------------------------------------------------------------------------------------------------------------------------------------------\n",
            "1     | 322920               | [Empty]                                                                     | Empty response                                    \n",
            "2     | 457495               | [Empty]                                                                     | Empty response                                    \n",
            "3     | 392371               | [Empty]                                                                     | Empty response                                    \n",
            "4     | 320190               | [Empty]                                                                     | Empty response                                    \n",
            "5     | 443004               | Nothing                                                                     | Nothing                                           \n",
            "6     | 447896               | I don't have any, namaskaram!                                               | Nothing                                           \n",
            "7     | 436206               | I dont want them to end here                                                | Nothing                                           \n",
            "8     | 398040               | [Empty]                                                                     | Empty response                                    \n",
            "9     | 390896               | All meeting la were well planned , and the discussions were apt for that    | Meeting Frequency | Content Feedback              \n",
            "      |                      | particular timing and situations. Thank you                                 |                                                   \n",
            "10    | 333412               | It was one of the best sessions. No suggestions.                            | Content Feedback                                  \n",
            "11    | 453139               | I wouldn't have minded 2 meetings a month 😅                                 | Meeting Frequency                                 \n",
            "12    | 441985               | [Empty]                                                                     | Empty response                                    \n",
            "13    | 440258               | Nothing                                                                     | Nothing                                           \n",
            "14    | 344249               | Myself, I don't have more suggestions; but another akka says she thinks     | Session Length | Content Feedback                 \n",
            "      |                      | is too long; perhaps divide it in 2 days would be better.                   |                                                   \n",
            "15    | 445692               | [Empty]                                                                     | Empty response                                    \n",
            "16    | 442653               | [Empty]                                                                     | Empty response                                    \n",
            "17    | 382722               | sometimes ots sleepy after food, i know its on us. buttttt yeah. felt       | Content Feedback                                  \n",
            "      |                      | drowsy after food.                                                          |                                                   \n",
            "18    | 340785               | Mandatory masks for those coughing                                          | Rules                                             \n",
            "19    | 353374               | [Empty]                                                                     | Empty response                                    \n",
            "20    | 442555               | [Empty]                                                                     | Empty response                                    \n",
            "21    | 442946               | all ok                                                                      | Nothing                                           \n",
            "22    | 443952               | I need more of these reminders and guidance on essential points. Be it      | Content Feedback | Sadhana Focus                  \n",
            "      |                      | tools or these parameters. It's insanely insightful and helpful.            |                                                   \n",
            "23    | 335260               | Too good. U guys are the best.                                              | Nothing                                           \n",
            "24    | 366361               | None. It was an amazing meet.                                               | Meeting Frequency | Sadhana Focus                 \n",
            "25    | 355210               | I am happy to be here as a participant, I whish we should have connection   | Meeting Frequency | Sadhana Focus                 \n",
            "      |                      | for ever and keep the check on us like these monthly meets. So the          |                                                   \n",
            "      |                      | Sadhanapada flame should not end with this meeting. Iam thinking for all    |                                                   \n",
            "      |                      | the initiative ignited flames(BSP,SP, the silence)program we should have    |                                                   \n",
            "      |                      | a reminder 🎗️ so that it cont lost or off.                                  |                                                   \n",
            "26    | 393556               | Nothing                                                                     | Nothing                                           \n",
            "27    | 404845               | [Empty]                                                                     | Empty response                                    \n",
            "28    | 441142               | Be more interactive rather than longer session with more and more and       | Sadhana Focus | Content Feedback                  \n",
            "      |                      | more information                                                            |                                                   \n",
            "29    | 442715               | [Empty]                                                                     | Empty response                                    \n",
            "30    | 451983               | [Empty]                                                                     | Empty response                                    \n",
            "31    | 386972               | Na                                                                          | No specific response                              \n",
            "32    | 441213               | Please review the Bhakthi Sadhana session. The instructions given by        | Sadhana Focus | Content Feedback                  \n",
            "      |                      | Poornaga Akka did not have much impact on me. During the Navratri monthly   |                                                   \n",
            "      |                      | meeting, one Akka shared guidance on Navratri sadhana that had a strong     |                                                   \n",
            "      |                      | and positive impact, but in the last monthly meeting, Poornaga Akka’s       |                                                   \n",
            "      |                      | instructions felt somewhat dry and less engaging.                           |                                                   \n",
            "33    | 395617               | Enhance the purpose with Sadhguru videos more                               | Sadhana Focus                                     \n",
            "34    | 445161               | [Empty]                                                                     | Empty response                                    \n",
            "35    | 442646               | No                                                                          | No specific response                              \n",
            "36    | 459041               | [Empty]                                                                     | Empty response                                    \n",
            "37    | 455728               | I want to know the tool to get in touch with Swami or Maa for queries       | Sadhana Focus                                     \n",
            "      |                      | would raised in Sadhana after Sadhanapada.                                  |                                                   \n",
            "38    | 441900               | [Empty]                                                                     | Empty response                                    \n",
            "39    | 452667               | all things are proper organise always .                                     | No specific response                              \n",
            "40    | 443753               | Nothing                                                                     | Nothing                                           \n",
            "41    | 301570               | [Empty]                                                                     | Empty response                                    \n",
            "42    | 445452               | [Empty]                                                                     | Empty response                                    \n",
            "43    | 442716               | Nothing                                                                     | Nothing                                           \n",
            "44    | 303643               | [Empty]                                                                     | Empty response                                    \n",
            "45    | 367076               | [Empty]                                                                     | Empty response                                    \n",
            "46    | 446780               | [Empty]                                                                     | Empty response                                    \n",
            "47    | 427868               | Focus on how they are keeping there practices in detail and what all they   | Sadhana Focus                                     \n",
            "      |                      | are able to do                                                              |                                                   \n",
            "48    | 453147               | [Empty]                                                                     | Empty response                                    \n",
            "49    | 413856               | [Empty]                                                                     | Empty response                                    \n",
            "50    | 457236               | .                                                                           | No specific response                              \n",
            "51    | 446686               | More time for Sadhana                                                       | Sadhana Focus                                     \n",
            "52    | 436220               | [Empty]                                                                     | Empty response                                    \n",
            "53    | 354018               | You are doing good enough.                                                  | Nothing                                           \n",
            "54    | 302035               | Guided meditation of shambavi                                               | Sadhana Focus                                     \n",
            "55    | 366686               | More sadhguru videos                                                        | Sadhana Focus                                     \n",
            "56    | 350553               | I found it dynamic and helpful when Swami or Maa engaged in a dialogue      | Sadhana Focus                                     \n",
            "      |                      | with a participant during Q&A to answer her question                        |                                                   \n",
            "57    | 307697               | Fine                                                                        | No specific response                              \n",
            "58    | 450118               | [Empty]                                                                     | Empty response                                    \n",
            "59    | 374864               | [Empty]                                                                     | Empty response                                    \n",
            "60    | 324979               | Clearly saying how much time we have for sadhana before the meeting         | Meeting Frequency | Sadhana Focus                 \n",
            "61    | 336951               | [Empty]                                                                     | Empty response                                    \n",
            "62    | 343882               | [Empty]                                                                     | Empty response                                    \n",
            "----------------------------------------------------------------------------------------------------------------------------------------------------------------\n",
            "\n",
            "Satisfied with this assignment? (yes/no): yes\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# THEME ASSIGNMENT WITH JSON PERSISTENCE\n",
        "# ============================================================================\n",
        "\n",
        "import json\n",
        "from google.colab import files\n",
        "\n",
        "# Initialize if not exists\n",
        "if 'theme_assignments' not in globals():\n",
        "    theme_assignments = {}\n",
        "\n",
        "# ============================================================================\n",
        "# Assign themes to each row with real-time table display\n",
        "# ============================================================================\n",
        "\n",
        "print(f\"\\n{'='*100}\")\n",
        "print(\"ASSIGN THEMES TO ROWS\")\n",
        "print(f\"{'='*100}\\n\")\n",
        "\n",
        "# Extract ID column if available\n",
        "id_column = None\n",
        "id_keywords = ['sp id', 'id']\n",
        "for col in df.columns:\n",
        "    col_lower = col.lower().strip()\n",
        "    for keyword in id_keywords:\n",
        "        if keyword in col_lower:\n",
        "            id_column = col\n",
        "            break\n",
        "    if id_column:\n",
        "        break\n",
        "\n",
        "for col in themes_dict.keys():\n",
        "    themes = themes_dict[col]\n",
        "\n",
        "    satisfied_with_assignment = False\n",
        "\n",
        "    while not satisfied_with_assignment:\n",
        "        assignments = []\n",
        "\n",
        "        print(f\"Processing: {col}\")\n",
        "        print(f\"Available themes: {themes}\\n\")\n",
        "\n",
        "        # Header with ID column\n",
        "        header = f\"{'Row':<5} | {'ID':<20} | {'Response':<75} | {'Assigned Themes':<50}\"\n",
        "        print(header)\n",
        "        print(\"-\" * 160)\n",
        "\n",
        "        for idx in range(len(df)):\n",
        "            response = df[col].iloc[idx]\n",
        "            id_value = str(df[id_column].iloc[idx]).strip() if (id_column and pd.notna(df[id_column].iloc[idx])) else f\"Row_{idx+1}\"\n",
        "\n",
        "            # Check if response is empty\n",
        "            if pd.isna(response) or str(response).strip() == '':\n",
        "                assigned_themes = [EMPTY_CATEGORY]\n",
        "            else:\n",
        "                response_str = str(response).strip()\n",
        "                prompt = f\"\"\"Assign themes from this list to the response.\n",
        "\n",
        "Rules:\n",
        "- If response is empty, null, NA, N/A, None, Nil, N.A., or dash (-), assign \"{NA_CATEGORY}\"\n",
        "- If the response doesn't match any theme, assign \"{OTHERS_CATEGORY}\"\n",
        "- Otherwise, assign 1-3 most relevant themes from the list\n",
        "\n",
        "Available themes: {themes}\n",
        "\n",
        "Response: {response_str}\n",
        "\n",
        "Return ONLY as Python list (no JSON, no extra text):\n",
        "['theme1', 'theme2']\"\"\"\n",
        "\n",
        "                api_response = client.chat.completions.create(\n",
        "                    model=MODEL,\n",
        "                    messages=[{\"role\": \"user\", \"content\": prompt}],\n",
        "                    temperature=THEME_ASSIGNMENT_TEMPERATURE,\n",
        "                )\n",
        "\n",
        "                response_text = api_response.choices[0].message.content.strip()\n",
        "                cost_tracker.log_call(MODEL, prompt, response_text, operation=\"Assign Themes\", question=col)\n",
        "\n",
        "                try:\n",
        "                    assigned_themes = eval(response_text)\n",
        "                    if not isinstance(assigned_themes, list):\n",
        "                        assigned_themes = list(assigned_themes)\n",
        "                    assigned_themes = [str(t).strip() for t in assigned_themes[:MAX_THEMES_PER_RESPONSE]]\n",
        "                except:\n",
        "                    assigned_themes = [OTHERS_CATEGORY]\n",
        "\n",
        "            assignments.append(assigned_themes)\n",
        "\n",
        "            response_display = str(response).strip() if pd.notna(response) else \"[Empty]\"\n",
        "            response_lines = textwrap.wrap(response_display, width=73)\n",
        "            themes_str = ' | '.join(assigned_themes)\n",
        "\n",
        "            if response_lines:\n",
        "                print(f\"{idx+1:<5} | {id_value:<20} | {response_lines[0]:<75} | {themes_str:<50}\")\n",
        "                for line in response_lines[1:]:\n",
        "                    print(f\"{'':5} | {'':20} | {line:<75} | {'':50}\")\n",
        "\n",
        "        print(\"-\" * 160 + \"\\n\")\n",
        "\n",
        "        feedback = input(\"Satisfied with this assignment? (yes/no): \").lower()\n",
        "        if feedback == \"yes\":\n",
        "            satisfied_with_assignment = True\n",
        "            theme_assignments[col] = assignments\n",
        "        else:\n",
        "            print(\"\\nRe-assigning themes...\\n\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "rBhVKVLgq9Lc",
        "outputId": "efe910fa-8541-4d63-e3f8-b4077ce8c25e"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "\n",
            "====================================================================================================\n",
            "Adding theme columns next to source questions\n",
            "====================================================================================================\n",
            "\n",
            "✓ Added column: [Themes] What is one key takeaway you got from the monthly meeting session?\n",
            "✓ Added column: [Themes] What is one suggestion you have for the monthly meeting\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# Tag the themes to the responses row-wise\n",
        "# ============================================================================\n",
        "\n",
        "print(f\"\\n{'='*100}\")\n",
        "print(\"Adding theme columns next to source questions\")\n",
        "print(f\"{'='*100}\\n\")\n",
        "\n",
        "new_df = pd.DataFrame()\n",
        "for col in df.columns:\n",
        "    new_df[col] = df[col]\n",
        "\n",
        "    theme_col_name = f\"[Themes] {col}\"\n",
        "    if col in theme_assignments:\n",
        "        theme_list = theme_assignments[col]\n",
        "        full_theme_list = []\n",
        "        response_idx = 0\n",
        "        for i in range(len(df)):\n",
        "            if pd.notna(df[col].iloc[i]):\n",
        "                full_theme_list.append(' | '.join(theme_list[response_idx]))\n",
        "                response_idx += 1\n",
        "            else:\n",
        "                full_theme_list.append(None)\n",
        "        new_df[theme_col_name] = full_theme_list\n",
        "        print(f\"✓ Added column: {theme_col_name}\")\n",
        "\n",
        "df = new_df"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "keQWr42jrAUh",
        "outputId": "2c99b77a-9b99-473c-88d1-680bbe1e53ea"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "\n",
            "====================================================================================================\n",
            "UPDATED DATAFRAME (showing open-ended columns and their themes)\n",
            "====================================================================================================\n",
            "\n",
            "Row No               | ID                   | Timestamp                                                                        | What is one key takeaway you got from the monthly meeting session?               | [Themes] What is one key takeaway you got from the monthly meeting session?      | What is one suggestion you have for the monthly meeting                          | [Themes] What is one suggestion you have for the monthly meeting                \n",
            "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n",
            "1                    | 322920               | 2026-01-11 10:05:18.633000                                                       | Guided meditation by Sadhguru                                                    | Guided Meditation                                                                |                                                                                  |                                                                                 \n",
            "\n",
            "2                    | 457495               | 2026-01-11 10:06:54.078000                                                       |                                                                                  |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "3                    | 392371               | 2026-01-11 10:07:54.682000                                                       | Sadhanapada doesn't end with this program it's a life long process               | Empty response                                                                   |                                                                                  |                                                                                 \n",
            "\n",
            "4                    | 320190               | 2026-01-11 10:08:14.621000                                                       | Made me think more about life after Sadhanapada in a practical sense. Especially | Life After Sadhanapada                                                           |                                                                                  |                                                                                 \n",
            "                     |                      |                                                                                  | when the Ex-army anna said Sadhanapada does not end with the program during the  |                                                                                  |                                                                                  |                                                                                 \n",
            "                     |                      |                                                                                  | Alumni discussion                                                                |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "5                    | 443004               | 2026-01-11 10:09:44.906000                                                       | See good in people and don't judge them how they are behaving                    | Life After Sadhanapada | Alumni Influence                                        | Nothing                                                                          | Empty response                                                                  \n",
            "\n",
            "6                    | 447896               | 2026-01-11 10:10:49.324000                                                       | This monthly meeting give me a sense of urgency, wich is good in a way becouse   | Stillness And Reflection                                                         | I don't have any, namaskaram!                                                    | Empty response                                                                  \n",
            "                     |                      |                                                                                  | gives me more energy and push me to push mylself more, I can't believe 7 months  |                                                                                  |                                                                                  |                                                                                 \n",
            "                     |                      |                                                                                  | passed fast like this! i need to give everything in this last mandala!           |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "7                    | 436206               | 2026-01-11 10:11:02.064000                                                       | Lesson from Shri Ram's life that Sadhguru shared with us about killing Ravana    | Life After Sadhanapada | Stillness And Reflection                                | I dont want them to end here                                                     | Empty response                                                                  \n",
            "\n",
            "8                    | 398040               | 2026-01-11 10:11:41.018000                                                       |                                                                                  |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "9                    | 390896               | 2026-01-11 10:12:06.844000                                                       | Seeing best in people , loved the conversations as well with SP alumni , feeling | Life After Sadhanapada                                                           | All meeting la were well planned , and the discussions were apt for that         | Empty response                                                                  \n",
            "                     |                      |                                                                                  | sad that the program is ending                                                   |                                                                                  | particular timing and situations. Thank you                                      |                                                                                 \n",
            "\n",
            "10                   | 333412               | 2026-01-11 10:23:07.049000                                                       | To continue seeing best in people.                                               | Empty response                                                                   | It was one of the best sessions. No suggestions.                                 | Nothing                                                                         \n",
            "\n",
            "11                   | 453139               | 2026-01-11 10:26:55.535000                                                       | Seing the best in people is not just about being non judgemental, but also about | Life After Sadhanapada | Alumni Influence                                        | I wouldn't have minded 2 meetings a month 😅                                      | Nothing                                                                         \n",
            "                     |                      |                                                                                  | making the higher possibilities prevelent all arround us.                        |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "12                   | 441985               | 2026-01-11 10:30:06.854000                                                       | To look at people fresh as they are                                              | Stillness And Reflection                                                         |                                                                                  |                                                                                 \n",
            "\n",
            "13                   | 440258               | 2026-01-11 10:39:26.529000                                                       | I have to keep my prejudices away and see the best in people, and if I learn to  | Stillness And Reflection | Life After Sadhanapada                                | Nothing                                                                          | Nothing                                                                         \n",
            "                     |                      |                                                                                  | do that, I can reap the benefits of my sadhana during kaivalyapada               |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "14                   | 344249               | 2026-01-11 10:48:02.244000                                                       | Rekindle Samyama practice                                                        | Stillness And Reflection                                                         | Myself, I don't have more suggestions; but another akka says she thinks is too   | Empty response                                                                  \n",
            "                     |                      |                                                                                  |                                                                                  |                                                                                  | long; perhaps divide it in 2 days would be better.                               |                                                                                 \n",
            "\n",
            "15                   | 445692               | 2026-01-11 10:59:07.750000                                                       | Whatever we pay our attention to will grow, so we should select the best in      | Life After Sadhanapada                                                           |                                                                                  |                                                                                 \n",
            "                     |                      |                                                                                  | people to look at                                                                |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "16                   | 442653               | 2026-01-11 11:25:09.589000                                                       | Being able to see the sweetness in people and only condemning people's quality.  | Samyama Practice                                                                 |                                                                                  |                                                                                 \n",
            "                     |                      |                                                                                  | Life after SP interviews were so relatable. I enjoyed Samyama meditation         |                                                                                  |                                                                                  |                                                                                 \n",
            "                     |                      |                                                                                  | practice                                                                         |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "17                   | 382722               | 2026-01-11 12:11:35.486000                                                       | how to carry on the pracxtices outside isha also, and stillness and just how     | Stillness And Reflection                                                         | sometimes ots sleepy after food, i know its on us. buttttt yeah. felt drowsy     | Meeting Frequency | Content Feedback                                            \n",
            "                     |                      |                                                                                  | magical the montly parameters are.                                               |                                                                                  | after food.                                                                      |                                                                                 \n",
            "\n",
            "18                   | 340785               | 2026-01-11 12:27:40.632000                                                       | Life after sadhanapada is something that will challenge you! Look forward to it  | Life After Sadhanapada | Samyama Practice                                        | Mandatory masks for those coughing                                               | Content Feedback                                                                \n",
            "\n",
            "19                   | 353374               | 2026-01-11 15:06:13.252000                                                       | Samyama Meditation                                                               | Life After Sadhanapada | Stillness And Reflection                                |                                                                                  |                                                                                 \n",
            "\n",
            "20                   | 442555               | 2026-01-12 09:21:30.696000                                                       |                                                                                  |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "21                   | 442946               | 2026-01-12 09:25:02.577000                                                       | swamis word \"this is the last mandala\"                                           | Life After Sadhanapada                                                           | all ok                                                                           | Meeting Frequency                                                               \n",
            "\n",
            "22                   | 443952               | 2026-01-12 09:27:49.143000                                                       | Seeing the best in people and dropping all my conclusions this Pongal.           | Samyama Practice                                                                 | I need more of these reminders and guidance on essential points. Be it tools or  | Empty response                                                                  \n",
            "                     |                      |                                                                                  |                                                                                  |                                                                                  | these parameters. It's insanely insightful and helpful.                          |                                                                                 \n",
            "\n",
            "23                   | 335260               | 2026-01-12 09:33:30.246000                                                       | To see the best in people. This really helped me out in daily interaction with   | Empty response                                                                   | Too good. U guys are the best.                                                   | Nothing                                                                         \n",
            "                     |                      |                                                                                  | people.                                                                          |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "24                   | 366361               | 2026-01-12 09:35:44.148000                                                       | One takeaway is to keep my sadhana on even after going back home and be          | Life After Sadhanapada | Other themes                                            | None. It was an amazing meet.                                                    | Session Length | Content Feedback                                               \n",
            "                     |                      |                                                                                  | consistent with the practices. I have seen positive changes within me so I know  |                                                                                  |                                                                                  |                                                                                 \n",
            "                     |                      |                                                                                  | that these practices are going to be for life now.                               |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "25                   | 355210               | 2026-01-12 09:41:20.693000                                                       | Bhakti is the root of shakti.                                                    | Stillness And Reflection                                                         | I am happy to be here as a participant, I whish we should have connection for    | Empty response                                                                  \n",
            "                     |                      |                                                                                  |                                                                                  |                                                                                  | ever and keep the check on us like these monthly meets. So the Sadhanapada flame |                                                                                 \n",
            "                     |                      |                                                                                  |                                                                                  |                                                                                  | should not end with this meeting. Iam thinking for all the initiative ignited    |                                                                                 \n",
            "                     |                      |                                                                                  |                                                                                  |                                                                                  | flames(BSP,SP, the silence)program we should have a reminder 🎗️ so that it cont  |                                                                                 \n",
            "                     |                      |                                                                                  |                                                                                  |                                                                                  | lost or off.                                                                     |                                                                                 \n",
            "\n",
            "26                   | 393556               | 2026-01-12 09:43:57.696000                                                       | Stillness                                                                        | Other themes                                                                     | Nothing                                                                          | Empty response                                                                  \n",
            "\n",
            "27                   | 404845               | 2026-01-12 15:23:16.970000                                                       | Start stop continue reflection                                                   | Life After Sadhanapada                                                           |                                                                                  |                                                                                 \n",
            "\n",
            "28                   | 441142               | 2026-01-12 16:33:06.467000                                                       | Start Stop and Continue that is something I needed and the fall back of Guided   | Other themes                                                                     | Be more interactive rather than longer session with more and more and more       | Content Feedback                                                                \n",
            "                     |                      |                                                                                  | session that Kind of stuck with me                                               |                                                                                  | information                                                                      |                                                                                 \n",
            "\n",
            "29                   | 442715               | 2026-01-12 16:42:03.191000                                                       |                                                                                  |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "30                   | 451983               | 2026-01-12 17:37:18.417000                                                       |                                                                                  |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "31                   | 386972               | 2026-01-12 21:22:39.316000                                                       | Start/Stop/Continue reflection session                                           | Stillness And Reflection                                                         | Na                                                                               | Rules                                                                           \n",
            "\n",
            "32                   | 441213               | 2026-01-13 11:22:00.910000                                                       | This was the last monthly meeting, and I’m going to miss all the laughter we     | Stillness And Reflection                                                         | Please review the Bhakthi Sadhana session. The instructions given by Poornaga    | Empty response                                                                  \n",
            "                     |                      |                                                                                  | shared. Everything that happened during the meeting has become a key takeaway    |                                                                                  | Akka did not have much impact on me. During the Navratri monthly meeting, one    |                                                                                 \n",
            "                     |                      |                                                                                  | for me.                                                                          |                                                                                  | Akka shared guidance on Navratri sadhana that had a strong and positive impact,  |                                                                                 \n",
            "                     |                      |                                                                                  |                                                                                  |                                                                                  | but in the last monthly meeting, Poornaga Akka’s instructions felt somewhat dry  |                                                                                 \n",
            "                     |                      |                                                                                  |                                                                                  |                                                                                  | and less engaging.                                                               |                                                                                 \n",
            "\n",
            "33                   | 395617               | 2026-01-13 11:39:36.915000                                                       | Witnessing Samyama meditation as a possibility for my self                       | Guided Meditation                                                                | Enhance the purpose with Sadhguru videos more                                    | Empty response                                                                  \n",
            "\n",
            "34                   | 445161               | 2026-01-13 13:59:20.329000                                                       | Parameter questions,  life after sadhanapada,  guided samyama practices          | Empty response                                                                   |                                                                                  |                                                                                 \n",
            "\n",
            "35                   | 442646               | 2026-01-13 14:04:00.462000                                                       | Weekly parameters question                                                       | Empty response                                                                   | No                                                                               | Nothing                                                                         \n",
            "\n",
            "36                   | 459041               | 2026-01-13 14:04:02.522000                                                       | Seeing the best in people                                                        | Stillness And Reflection                                                         |                                                                                  |                                                                                 \n",
            "\n",
            "37                   | 455728               | 2026-01-13 14:05:13.183000                                                       | Life after Sadhanapada                                                           | Life After Sadhanapada | Alumni Influence                                        | I want to know the tool to get in touch with Swami or Maa for queries would      | Content Feedback | Sadhana Focus                                                \n",
            "                     |                      |                                                                                  |                                                                                  |                                                                                  | raised in Sadhana after Sadhanapada.                                             |                                                                                 \n",
            "\n",
            "38                   | 441900               | 2026-01-13 14:05:49.475000                                                       | Seeing the best in the people                                                    | Samyama Practice                                                                 |                                                                                  |                                                                                 \n",
            "\n",
            "39                   | 452667               | 2026-01-13 14:19:53.337000                                                       | everything was ok for me                                                         | Life After Sadhanapada | Samyama Practice | Guided Meditation                    | all things are proper organise always .                                          | Nothing                                                                         \n",
            "\n",
            "40                   | 443753               | 2026-01-13 14:35:53.693000                                                       | Reality check after sadhanapada                                                  | Other themes                                                                     | Nothing                                                                          | Meeting Frequency | Sadhana Focus                                               \n",
            "\n",
            "41                   | 301570               | 2026-01-13 14:43:27.903000                                                       |                                                                                  |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "42                   | 445452               | 2026-01-13 14:45:35                                                              |                                                                                  |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "43                   | 442716               | 2026-01-13 15:16:46.532000                                                       | Sadhguru's videos                                                                | Other themes                                                                     | Nothing                                                                          | Meeting Frequency | Sadhana Focus                                               \n",
            "\n",
            "44                   | 303643               | 2026-01-13 15:42:25.204000                                                       | life after sadhanapada from alumnis🙏                                             | Life After Sadhanapada                                                           |                                                                                  |                                                                                 \n",
            "\n",
            "45                   | 367076               | 2026-01-13 15:46:42.392000                                                       |                                                                                  |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "46                   | 446780               | 2026-01-13 15:47:09.885000                                                       | Start /Stop/Continue reflection                                                  | Other themes                                                                     |                                                                                  |                                                                                 \n",
            "\n",
            "47                   | 427868               | 2026-01-13 15:51:44.028000                                                       | Seeing the best in people                                                        | Other themes                                                                     | Focus on how they are keeping there practices in detail and what all they are    | Nothing                                                                         \n",
            "                     |                      |                                                                                  |                                                                                  |                                                                                  | able to do                                                                       |                                                                                 \n",
            "\n",
            "48                   | 453147               | 2026-01-13 15:52:33.913000                                                       | Life after sadhanapadha. Few questions got answered                              | Life After Sadhanapada                                                           |                                                                                  |                                                                                 \n",
            "\n",
            "49                   | 413856               | 2026-01-13 15:53:46.748000                                                       | I find inside what changes happened in last six month                            | Empty response                                                                   |                                                                                  |                                                                                 \n",
            "\n",
            "50                   | 457236               | 2026-01-13 15:57:50.845000                                                       | Seeing the best in everyone' was a key takeaway for me, as I am always used to   | Empty response                                                                   | .                                                                                | Empty response                                                                  \n",
            "                     |                      |                                                                                  | do that but sometimes i got hurt, but during session I have realised that it has |                                                                                  |                                                                                  |                                                                                 \n",
            "                     |                      |                                                                                  | already gave me a strength.                                                      |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "51                   | 446686               | 2026-01-13 16:13:51.510000                                                       | See the best in people                                                           | Other themes                                                                     | More time for Sadhana                                                            | Sadhana Focus | Content Feedback                                                \n",
            "\n",
            "52                   | 436220               | 2026-01-13 16:29:21.590000                                                       | Trying to see best in people                                                     | Life After Sadhanapada | Alumni Influence                                        |                                                                                  |                                                                                 \n",
            "\n",
            "53                   | 354018               | 2026-01-13 17:43:09.342000                                                       | Rose tree.                                                                       | Empty response                                                                   | You are doing good enough.                                                       | Empty response                                                                  \n",
            "\n",
            "54                   | 302035               | 2026-01-13 19:38:20.166000                                                       | To see best in people                                                            | Stillness And Reflection                                                         | Guided meditation of shambavi                                                    | Empty response                                                                  \n",
            "\n",
            "55                   | 366686               | 2026-01-13 21:58:23.623000                                                       | Preparing for post sadhanapada                                                   | Other themes                                                                     | More sadhguru videos                                                             | No specific response                                                            \n",
            "\n",
            "56                   | 350553               | 2026-01-13 22:00:57.881000                                                       | Seeing the best in people is a tool that raises my awareness of what my          | Life After Sadhanapada                                                           | I found it dynamic and helpful when Swami or Maa engaged in a dialogue with a    | Sadhana Focus | Content Feedback                                                \n",
            "                     |                      |                                                                                  | perception is in that moment and how I’m in control of my mind which, when used  |                                                                                  | participant during Q&A to answer her question                                    |                                                                                 \n",
            "                     |                      |                                                                                  | to see the best, can open up the possibility of a different or new perception.   |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "57                   | 307697               | 2026-01-13 22:54:12.205000                                                       | Alumini speech                                                                   | Life After Sadhanapada                                                           | Fine                                                                             | Sadhana Focus                                                                   \n",
            "\n",
            "58                   | 450118               | 2026-01-14 08:23:08.161000                                                       |                                                                                  |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "59                   | 374864               | 2026-01-15 16:55:36.400000                                                       |                                                                                  |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "60                   | 324979               | 2026-01-15 18:48:10.762000                                                       | Sadhanapada will start afterthought program ends                                 | Stillness And Reflection                                                         | Clearly saying how much time we have for sadhana before the meeting              | Empty response                                                                  \n",
            "\n",
            "61                   | 336951               | 2026-01-16 11:35:11.792000                                                       |                                                                                  |                                                                                  |                                                                                  |                                                                                 \n",
            "\n",
            "62                   | 343882               | 2026-01-17 22:32:57.094000                                                       |                                                                                  |                                                                                  |                                                                                  |                                                                                 \n",
            "\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# DISPLAY UPDATED DATAFRAME WITH THEMES\n",
        "# ============================================================================\n",
        "\n",
        "print(f\"\\n{'='*100}\")\n",
        "print(\"UPDATED DATAFRAME (showing open-ended columns and their themes)\")\n",
        "print(f\"{'='*100}\\n\")\n",
        "\n",
        "display_cols_filtered = []\n",
        "for col in results_df[results_df['Type'] == 'Open-ended']['Question'].tolist():\n",
        "    if not any(keyword.lower() in col.lower() for keyword in id_keywords):\n",
        "        if col in df.columns:\n",
        "            display_cols_filtered.append(col)\n",
        "            theme_col = f\"[Themes] {col}\"\n",
        "            if theme_col in df.columns:\n",
        "                display_cols_filtered.append(theme_col)\n",
        "\n",
        "if not display_cols_filtered:\n",
        "    print(\"⚠ No theme columns found in dataframe.\")\n",
        "else:\n",
        "    display_df = df[display_cols_filtered]\n",
        "\n",
        "    header_parts = [\"Row No\", \"ID\"]\n",
        "    for col in display_cols_filtered:\n",
        "        col_name = col[:77] if len(col) > 77 else col\n",
        "        header_parts.append(col_name)\n",
        "\n",
        "    header_line = \"\"\n",
        "    for i, part in enumerate(header_parts):\n",
        "        if i < 2:\n",
        "            header_line += f\"{part:<20} | \"\n",
        "        else:\n",
        "            header_line += f\"{part:<80}\"\n",
        "            if i < len(header_parts) - 1:\n",
        "                header_line += \" | \"\n",
        "\n",
        "    print(header_line)\n",
        "    print(\"-\" * len(header_line))\n",
        "\n",
        "    for idx, row in display_df.iterrows():\n",
        "        id_value = str(df.iloc[idx].get('SP ID Please :)', '') or df.iloc[idx].get('SP ID:', '') or '')\n",
        "\n",
        "        wrapped_values = []\n",
        "        max_lines = 1\n",
        "\n",
        "        for col_name in display_cols_filtered:\n",
        "            cell_value = str(row[col_name]) if pd.notna(row[col_name]) else \"\"\n",
        "            lines = textwrap.wrap(cell_value, width=80) if cell_value else [\"\"]\n",
        "            wrapped_values.append(lines)\n",
        "            max_lines = max(max_lines, len(lines))\n",
        "\n",
        "        for line_idx in range(max_lines):\n",
        "            line_parts = []\n",
        "\n",
        "            if line_idx == 0:\n",
        "                line_parts.append(str(idx + 1))\n",
        "                line_parts.append(id_value[:20])\n",
        "            else:\n",
        "                line_parts.append(\"\")\n",
        "                line_parts.append(\"\")\n",
        "\n",
        "            for col_idx, wrapped_col in enumerate(wrapped_values):\n",
        "                if line_idx < len(wrapped_col):\n",
        "                    line_parts.append(wrapped_col[line_idx])\n",
        "                else:\n",
        "                    line_parts.append(\"\")\n",
        "\n",
        "            print(\" | \".join([f\"{part:<20}\" if i < 2 else f\"{part:<80}\" for i, part in enumerate(line_parts)]))\n",
        "\n",
        "        print()"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "d5RvoVZ6PxId",
        "outputId": "7e3ef4a0-e8dc-4c4c-f10a-02f7a10cadc4"
      },
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "[\"How supportive did you find the following sessions of the monthly meeting? [Weekly parameter question - 'Seeing the best in people']\",\n",
              " 'How supportive did you find the following sessions of the monthly meeting? [Sadhguru Videos]',\n",
              " \"How supportive did you find the following sessions of the monthly meeting? [Video conversation on 'Life after Sadhanapada' from SP alumni]\",\n",
              " 'How supportive did you find the following sessions of the monthly meeting? [Samyama meditation/Achala arpanam (whichever applicable)]',\n",
              " 'How supportive did you find the following sessions of the monthly meeting? [Guided meditation by Sadhguru]',\n",
              " 'How supportive did you find the following sessions of the monthly meeting? [Start/Stop/Continue reflection session]']"
            ]
          },
          "metadata": {},
          "execution_count": 38
        }
      ],
      "source": [
        "results_df[results_df['Type'] == 'Close-ended']['Question'].tolist()"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "tQjR-uLZHsJa",
        "outputId": "a7e1d1fa-b254-4d54-cf7d-c70a9b1c3f38"
      },
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "['Timestamp',\n",
              " 'SP ID:',\n",
              " 'What is one key takeaway you got from the monthly meeting session?',\n",
              " 'What is one suggestion you have for the monthly meeting']"
            ]
          },
          "metadata": {},
          "execution_count": 39
        }
      ],
      "source": [
        "results_df[results_df['Type'] == 'Open-ended']['Question'].tolist()"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "znBY9C2tKB4j",
        "outputId": "17fba611-564b-4d8b-c1ae-50140db047d0"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "✓ Analysis data initialized\n",
            "\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# INITIALIZE ANALYSIS DATA (RUN THIS ONCE)\n",
        "# ============================================================================\n",
        "\n",
        "analysis_data = []\n",
        "print(\"✓ Analysis data initialized\\n\")\n",
        "\n",
        "# ============================================================================\n",
        "# HELPER FUNCTION - Add or Update Analysis Item\n",
        "# ============================================================================\n",
        "\n",
        "def add_or_update_analysis(q_item):\n",
        "    \"\"\"\n",
        "    Add new item to analysis_data or update existing one with same question.\n",
        "    \"\"\"\n",
        "    found = False\n",
        "    for i, item in enumerate(analysis_data):\n",
        "        if item['Question'] == q_item['Question']:\n",
        "            analysis_data[i] = q_item\n",
        "            print(f\"✓ Updated: {q_item['Question']}\\n\")\n",
        "            found = True\n",
        "            break\n",
        "\n",
        "    if not found:\n",
        "        analysis_data.append(q_item)\n",
        "        print(f\"✓ Added: {q_item['Question']}\\n\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "HRva3iJOq_aL",
        "outputId": "180a4910-b842-4cbe-c161-c604061ac291"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "\n",
            "Close-ended questions to analyze:\n",
            "  0: How supportive did you find the following sessions of the monthly meeting? [Weekly parameter question - 'Seeing the best in people']\n",
            "  1: How supportive did you find the following sessions of the monthly meeting? [Sadhguru Videos]\n",
            "  2: How supportive did you find the following sessions of the monthly meeting? [Video conversation on 'Life after Sadhanapada' from SP alumni]\n",
            "  3: How supportive did you find the following sessions of the monthly meeting? [Samyama meditation/Achala arpanam (whichever applicable)]\n",
            "  4: How supportive did you find the following sessions of the monthly meeting? [Guided meditation by Sadhguru]\n",
            "  5: How supportive did you find the following sessions of the monthly meeting? [Start/Stop/Continue reflection session]\n",
            "\n",
            "Simple questions found: 0\n",
            "Grid questions found: 1\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# Generate summary tables for close-ended questions\n",
        "# ============================================================================\n",
        "\n",
        "close_ended_cols = results_df[results_df['Type'] == 'Close-ended']['Question'].tolist()\n",
        "\n",
        "# Filter out metadata columns (id, timestamp, email, name, sp id)\n",
        "# Use word boundaries to avoid matching 'id' in words like 'relatable'\n",
        "id_keywords = ['timestamp', 'email', 'sp id', 'sp_id']\n",
        "close_ended_cols = [col for col in close_ended_cols\n",
        "                    if not any(kw.lower() in col.lower().strip() for kw in id_keywords)]\n",
        "\n",
        "print(f\"\\nClose-ended questions to analyze:\")\n",
        "for i, col in enumerate(close_ended_cols):\n",
        "    print(f\"  {i}: {col}\")\n",
        "\n",
        "grouped_questions = {}\n",
        "simple_questions = []\n",
        "\n",
        "for col in close_ended_cols:\n",
        "    if '[' in col and ']' in col:\n",
        "        parent_q = col[:col.find('[')].strip()\n",
        "        sub_q = col[col.find('[')+1:col.find(']')].strip()\n",
        "        if parent_q not in grouped_questions:\n",
        "            grouped_questions[parent_q] = []\n",
        "        grouped_questions[parent_q].append((sub_q, col))\n",
        "    else:\n",
        "        simple_questions.append(col)\n",
        "\n",
        "print(f\"\\nSimple questions found: {len(simple_questions)}\")\n",
        "print(f\"Grid questions found: {len(grouped_questions)}\")\n",
        "\n",
        "analysis_data = []\n",
        "question_counter = 1"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "V9bK_J2y5X-r",
        "outputId": "7d7e5eea-8b56-44d8-bb39-15d62f5966d7"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "\n",
            "====================================================================================================\n",
            "SIMPLE QUESTIONS ANALYSIS\n",
            "====================================================================================================\n",
            "\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# GENERATE INSIGHTS - SIMPLE QUESTIONS likert scale without grid\n",
        "# ============================================================================\n",
        "\n",
        "print(f\"\\n{'='*100}\")\n",
        "print(\"SIMPLE QUESTIONS ANALYSIS\")\n",
        "print(f\"{'='*100}\\n\")\n",
        "\n",
        "question_counter = 1\n",
        "\n",
        "for col in simple_questions:\n",
        "    if col in df.columns:\n",
        "        print(f\"Q{question_counter}. {col[:80]}\\n\")\n",
        "\n",
        "        total_rows = len(df)\n",
        "        value_counts = df[col].value_counts()\n",
        "        na_count = df[col].isna().sum()\n",
        "\n",
        "        # Identify NA-like values\n",
        "        na_like_values = []\n",
        "        for idx, val in df[col].items():\n",
        "            if pd.notna(val):\n",
        "                val_str = str(val).lower().strip()\n",
        "                if val_str in ['na', 'n/a', 'none', 'null', 'nil', 'n.a.', '-', '']:\n",
        "                    na_like_values.append(val)\n",
        "\n",
        "        # Remove NA-like values from counts\n",
        "        filtered_value_counts = value_counts.copy()\n",
        "        for val in na_like_values:\n",
        "            if val in filtered_value_counts.index:\n",
        "                na_count += filtered_value_counts[val]\n",
        "                del filtered_value_counts[val]\n",
        "\n",
        "        print(f\"{'Category':<{MAX_CATEGORY_LENGTH}} | {'Count':<15} | {'%':<10}\")\n",
        "        print(\"-\" * TABLE_SEPARATOR_LENGTH)\n",
        "\n",
        "        table_data = []\n",
        "        for category, count in filtered_value_counts.items():\n",
        "            percentage = (count / total_rows) * 100\n",
        "            print(f\"{str(category):<{MAX_CATEGORY_LENGTH}} | {count:<15} | {percentage:>6.1f}%\")\n",
        "            table_data.append({'Category': str(category), 'Count': count, '%': f\"{percentage:.1f}%\"})\n",
        "\n",
        "        if na_count > 0:\n",
        "            na_percentage = (na_count / total_rows) * 100\n",
        "            print(f\"{NA_CATEGORY:<{MAX_CATEGORY_LENGTH}} | {na_count:<15} | {na_percentage:>6.1f}%\")\n",
        "            na_examples = []\n",
        "            for idx, val in df[col].items():\n",
        "                if pd.isna(val) or (pd.notna(val) and str(val).lower().strip() in ['na', 'n/a', 'none', 'null', 'nil', 'n.a.', '-', '']):\n",
        "                    na_examples.append(str(val) if pd.notna(val) else \"[Empty/Null]\")\n",
        "                    if len(na_examples) >= NUM_EXAMPLES_PER_CATEGORY:\n",
        "                        break\n",
        "            na_examples_str = \" | \".join([f\"'{ex}'\" for ex in na_examples[:NUM_EXAMPLES_PER_CATEGORY]])\n",
        "            table_data.append({'Category': f\"{NA_CATEGORY} ({na_examples_str})\", 'Count': na_count, '%': f\"{na_percentage:.1f}%\"})\n",
        "\n",
        "        print(f\"{'TOTAL':<{MAX_CATEGORY_LENGTH}} | {total_rows:<15} | {'100.0%':<10}\\n\")\n",
        "        table_data.append({'Category': 'TOTAL', 'Count': total_rows, '%': '100.0%'})\n",
        "\n",
        "        table_summary = \"\\n\".join([f\"{item['Category']}: {item['Count']} ({item['%']})\" for item in table_data[:-1]])\n",
        "\n",
        "        prompt = f\"\"\"Analyze this data and provide 3-4 key insights.\n",
        "\n",
        "Data:\n",
        "{table_summary}\n",
        "\n",
        "For each insight, format as:\n",
        "Header (2-3 words): Full explanation in plain text\"\"\"\n",
        "\n",
        "        insights_response = client.chat.completions.create(\n",
        "            model=MODEL,\n",
        "            messages=[{\"role\": \"user\", \"content\": prompt}],\n",
        "            temperature=0.3,\n",
        "        )\n",
        "\n",
        "        insights_text = insights_response.choices[0].message.content.strip()\n",
        "        cost_tracker.log_call(MODEL, prompt, insights_text, operation=\"Insights - Simple Questions\", question=col)\n",
        "\n",
        "        print(\"KEY INSIGHTS:\")\n",
        "        print(insights_text)\n",
        "        print()\n",
        "\n",
        "        q_item = {\n",
        "            'Q#': f\"Q{question_counter}\",\n",
        "            'Question': col,\n",
        "            'Type': 'Simple',\n",
        "            'Table': pd.DataFrame(table_data),\n",
        "            'Insights': insights_text\n",
        "        }\n",
        "\n",
        "        add_or_update_analysis(q_item)\n",
        "        question_counter += 1\n"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "NVec5DT15cS-",
        "outputId": "4f631741-d95f-4c07-88ea-a07bd5c64981"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "\n",
            "====================================================================================================\n",
            "GRID QUESTIONS (2D) ANALYSIS\n",
            "====================================================================================================\n",
            "\n",
            "Q1. How supportive did you find the following sessions of the monthly meeting?\n",
            "\n",
            "Session Name                                       | Extremely helpful    | Neutral              | Not at all helpful   | Somewhat helpful     | Somewhat unhelpful   | Total\n",
            "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n",
            "Weekly parameter question - 'Seeing the best in people' | 49 (79.0%)           | 1 (1.6%)             | 1 (1.6%)             | 10 (16.1%)           | 1 (1.6%)             | 62 (100.0%)\n",
            "Sadhguru Videos                                    | 56 (90.3%)           | 0 (0.0%)             | 0 (0.0%)             | 6 (9.7%)             | 0 (0.0%)             | 62 (100.0%)\n",
            "Video conversation on 'Life after Sadhanapada' from SP alumni | 41 (66.1%)           | 4 (6.5%)             | 0 (0.0%)             | 16 (25.8%)           | 1 (1.6%)             | 62 (100.0%)\n",
            "Samyama meditation/Achala arpanam (whichever applicable) | 52 (83.9%)           | 5 (8.1%)             | 0 (0.0%)             | 5 (8.1%)             | 0 (0.0%)             | 62 (100.0%)\n",
            "Guided meditation by Sadhguru                      | 49 (79.0%)           | 2 (3.2%)             | 0 (0.0%)             | 11 (17.7%)           | 0 (0.0%)             | 62 (100.0%)\n",
            "Start/Stop/Continue reflection session             | 44 (71.0%)           | 3 (4.8%)             | 0 (0.0%)             | 14 (22.6%)           | 1 (1.6%)             | 62 (100.0%)\n",
            "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n",
            "TOTAL                                              | 291 (469.4%)         | 15 (24.2%)           | 1 (1.6%)             | 62 (100.0%)          | 3 (4.8%)             | 372 (600.0%)\n",
            "\n",
            "KEY INSIGHTS:\n",
            "1. Most Helpful Content:\n",
            "The data shows that Sadhguru Videos received the highest percentage of 'Extremely helpful' responses at 90.3%, indicating that this content was perceived as the most beneficial by the participants compared to other types of content.\n",
            "\n",
            "2. Consistency in Feedback:\n",
            "Across all categories, the percentage of 'Not at all helpful' responses was consistently low or non-existent, suggesting that the majority of participants found some level of value in each type of content provided, whether it be videos, meditations, or reflection sessions.\n",
            "\n",
            "3. Positive Perception of Samyama Meditation/Achala Arpanam:\n",
            "The Samyama meditation/Achala arpanam content received a high percentage of 'Extremely helpful' responses at 83.9%, indicating that this particular practice was well-received and considered highly beneficial by the participants.\n",
            "\n",
            "4. Room for Improvement in Start/Stop/Continue Reflection Session:\n",
            "While the Start/Stop/Continue reflection session was generally well-received, with 71% of participants finding it 'Extremely helpful', there were also a notable number of 'Somewhat helpful' responses. This suggests that there may be areas for improvement or adjustments in this particular type of content to further enhance its effectiveness.\n",
            "\n",
            "✓ Added: How supportive did you find the following sessions of the monthly meeting?\n",
            "\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# GENERATE INSIGHTS - GRID QUESTIONS\n",
        "# ============================================================================\n",
        "\n",
        "print(f\"\\n{'='*100}\")\n",
        "print(\"GRID QUESTIONS (2D) ANALYSIS\")\n",
        "print(f\"{'='*100}\\n\")\n",
        "\n",
        "for parent_q, sub_questions in grouped_questions.items():\n",
        "    print(f\"Q{question_counter}. {parent_q[:80]}\\n\")\n",
        "\n",
        "    total_rows = len(df)\n",
        "    all_categories = set()\n",
        "    for sub_q, col in sub_questions:\n",
        "        categories = df[col].value_counts().index.tolist()\n",
        "        all_categories.update(categories)\n",
        "    categories = sorted(list(all_categories))\n",
        "\n",
        "    print(f\"{'Session Name':<50}\", end=\"\")\n",
        "    for category in categories:\n",
        "        cat_str = str(category)[:18]\n",
        "        print(f\" | {cat_str:<20}\", end=\"\")\n",
        "    print(\" | Total\")\n",
        "\n",
        "    separator_len = 50 + len(categories) * 22 + 10\n",
        "    print(\"-\" * separator_len)\n",
        "\n",
        "    col_totals = {cat: 0 for cat in categories}\n",
        "    grid_table_data = []\n",
        "\n",
        "    for sub_q, col in sub_questions:\n",
        "        print(f\"{sub_q:<50}\", end=\"\")\n",
        "        value_counts = df[col].value_counts()\n",
        "        row_sum = 0\n",
        "        row_entry = {'Session Name': sub_q}\n",
        "\n",
        "        for category in categories:\n",
        "            count = value_counts.get(category, 0)\n",
        "            percentage = (count / total_rows) * 100 if total_rows > 0 else 0\n",
        "            data_str = f\"{count} ({percentage:.1f}%)\"\n",
        "            print(f\" | {data_str:<20}\", end=\"\")\n",
        "            col_totals[category] += count\n",
        "            row_sum += count\n",
        "            row_entry[f'{category}'] = data_str\n",
        "\n",
        "        print(f\" | {row_sum} ({(row_sum/total_rows)*100:.1f}%)\")\n",
        "        row_entry['Total'] = f\"{row_sum} ({(row_sum/total_rows)*100:.1f}%)\"\n",
        "        grid_table_data.append(row_entry)\n",
        "\n",
        "    print(\"-\" * separator_len)\n",
        "    print(f\"{'TOTAL':<50}\", end=\"\")\n",
        "    grand_total = 0\n",
        "    total_entry = {'Session Name': 'TOTAL'}\n",
        "    for category in categories:\n",
        "        count = col_totals[category]\n",
        "        percentage = (count / total_rows) * 100 if total_rows > 0 else 0\n",
        "        data_str = f\"{count} ({percentage:.1f}%)\"\n",
        "        print(f\" | {data_str:<20}\", end=\"\")\n",
        "        grand_total += count\n",
        "        total_entry[f'{category}'] = data_str\n",
        "    print(f\" | {grand_total} ({(grand_total/total_rows)*100:.1f}%)\")\n",
        "    total_entry['Total'] = f\"{grand_total} ({(grand_total/total_rows)*100:.1f}%)\"\n",
        "    grid_table_data.append(total_entry)\n",
        "    print()\n",
        "\n",
        "    grid_summary_str = \"\\n\".join([f\"{item['Session Name']}: {str({k: v for k, v in item.items() if k != 'Session Name'})}\" for item in grid_table_data[:-1]])\n",
        "\n",
        "    prompt = f\"\"\"Analyze this grid data and provide 3-4 key insights.\n",
        "\n",
        "Data:\n",
        "{grid_summary_str}\n",
        "\n",
        "For each insight, format as:\n",
        "Header (2-3 words): Full explanation in plain text\"\"\"\n",
        "\n",
        "    insights_response = client.chat.completions.create(\n",
        "        model=MODEL,\n",
        "        messages=[{\"role\": \"user\", \"content\": prompt}],\n",
        "        temperature=0.3,\n",
        "    )\n",
        "\n",
        "    insights_text = insights_response.choices[0].message.content.strip()\n",
        "    cost_tracker.log_call(MODEL, prompt, insights_text, operation=\"Insights - Grid Questions\", question=parent_q)\n",
        "\n",
        "    print(\"KEY INSIGHTS:\")\n",
        "    print(insights_text)\n",
        "    print()\n",
        "\n",
        "    q_item = {\n",
        "        'Q#': f\"Q{question_counter}\",\n",
        "        'Question': parent_q,\n",
        "        'Type': 'Grid (2D)',\n",
        "        'Table': pd.DataFrame(grid_table_data),\n",
        "        'Insights': insights_text\n",
        "    }\n",
        "\n",
        "    add_or_update_analysis(q_item)\n",
        "    question_counter += 1"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "uYGKwf5D5fQa",
        "outputId": "119ccad4-fbfa-45c8-c16a-b8e335068b1c"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "\n",
            "====================================================================================================\n",
            "THEME COLUMNS SUMMARY\n",
            "====================================================================================================\n",
            "\n",
            "\n",
            "====================================================================================================\n",
            "✓ Analysis complete. Total items: 1\n",
            "====================================================================================================\n",
            "\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# GENERATE INSIGHTS - THEME COLUMNS\n",
        "# ============================================================================\n",
        "\n",
        "print(f\"\\n{'='*100}\")\n",
        "print(\"THEME COLUMNS SUMMARY\")\n",
        "print(f\"{'='*100}\\n\")\n",
        "\n",
        "theme_cols = [col for col in df.columns if col.startswith('[Themes]')]\n",
        "\n",
        "for theme_col in theme_cols:\n",
        "    print(f\"Q{question_counter}. {theme_col}\\n\")\n",
        "\n",
        "    all_themes = []\n",
        "    for val in df[theme_col]:\n",
        "        if pd.notna(val):\n",
        "            val_str = str(val).strip()\n",
        "            if val_str:\n",
        "                themes = [t.strip() for t in val_str.split('|')]\n",
        "                all_themes.extend(themes)\n",
        "\n",
        "    theme_counts = Counter(all_themes)\n",
        "    total_rows = len(df)\n",
        "\n",
        "    print(f\"{'Theme':<60} | {'Count':<10} | {'%':<10}\")\n",
        "    print(\"-\" * 90)\n",
        "\n",
        "    table_theme_data = []\n",
        "    for theme, count in theme_counts.most_common():\n",
        "        percentage = (count / total_rows) * 100\n",
        "        print(f\"{theme:<60} | {count:<10} | {percentage:>6.1f}%\")\n",
        "        table_theme_data.append({'Theme': theme, 'Count': count, '%': f\"{percentage:.1f}%\"})\n",
        "\n",
        "    print(f\"{'TOTAL':<60} | {total_rows:<10} | {'100.0%':<10}\\n\")\n",
        "    table_theme_data.append({'Theme': 'TOTAL', 'Count': total_rows, '%': '100.0%'})\n",
        "\n",
        "    theme_summary = \"\\n\".join([f\"{item['Theme']}: {item['Count']} ({item['%']})\" for item in table_theme_data[:-1]])\n",
        "\n",
        "    prompt = f\"\"\"Analyze this theme data and provide 3-4 key insights.\n",
        "\n",
        "Data:\n",
        "{theme_summary}\n",
        "\n",
        "For each insight, format as:\n",
        "Header (2-3 words): Full explanation in plain text\"\"\"\n",
        "\n",
        "    insights_response = client.chat.completions.create(\n",
        "        model=MODEL,\n",
        "        messages=[{\"role\": \"user\", \"content\": prompt}],\n",
        "        temperature=0.3,\n",
        "    )\n",
        "\n",
        "    insights_text = insights_response.choices[0].message.content.strip()\n",
        "    cost_tracker.log_call(MODEL, prompt, insights_text, operation=\"Insights - Theme Columns\", question=theme_col)\n",
        "\n",
        "    print(\"KEY INSIGHTS:\")\n",
        "    print(insights_text)\n",
        "    print()\n",
        "\n",
        "    q_item = {\n",
        "        'Q#': f\"Q{question_counter}\",\n",
        "        'Question': theme_col,\n",
        "        'Type': 'Theme',\n",
        "        'Table': pd.DataFrame(table_theme_data),\n",
        "        'Insights': insights_text\n",
        "    }\n",
        "\n",
        "    add_or_update_analysis(q_item)\n",
        "    question_counter += 1\n",
        "\n",
        "print(f\"\\n{'='*100}\")\n",
        "print(f\"✓ Analysis complete. Total items: {len(analysis_data)}\")\n",
        "print(f\"{'='*100}\\n\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "0DKTl8yyugWQ",
        "outputId": "acc87b33-f131-4a88-b86b-147188082845"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "\n",
            "====================================================================================================\n",
            "EXPORTING TO EXCEL\n",
            "====================================================================================================\n",
            "\n",
            "✓ Complete analysis saved to: Programs Pulse Survey Jan'26 (1)_analysis.xlsx\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# EXPORT TO CONSOLIDATED EXCEL (2 SHEETS)\n",
        "# ============================================================================\n",
        "\n",
        "from openpyxl.styles import Font, PatternFill, Border, Side, Alignment\n",
        "from openpyxl.utils import get_column_letter\n",
        "import openpyxl\n",
        "\n",
        "print(f\"\\n{'='*100}\")\n",
        "print(\"EXPORTING TO EXCEL\")\n",
        "print(f\"{'='*100}\\n\")\n",
        "\n",
        "base_name = file_name.replace('.xlsx', '').replace('.xls', '')\n",
        "excel_file_name = f'{base_name}_analysis.xlsx'\n",
        "\n",
        "with pd.ExcelWriter(excel_file_name, engine='openpyxl') as writer:\n",
        "    # Sheet 1: Updated dataframe with themes\n",
        "    df.to_excel(writer, sheet_name='Data with Themes', index=False)\n",
        "\n",
        "    # Sheet 2: Analysis with formatted tables and insights\n",
        "    if 'Analysis' not in writer.sheets:\n",
        "        writer.book.create_sheet('Analysis')\n",
        "\n",
        "    ws = writer.sheets['Analysis']\n",
        "    start_row = 1\n",
        "\n",
        "    for item in analysis_data:\n",
        "        # Add question header\n",
        "        ws[f'A{start_row}'] = f\"▶ {item['Q#']}: {item['Question']}\"\n",
        "        ws[f'A{start_row}'].font = Font(bold=True, size=12)\n",
        "        start_row += 1\n",
        "\n",
        "        ws[f'A{start_row}'] = f\"Type: {item['Type']}\"\n",
        "        ws[f'A{start_row}'].font = Font(italic=True)\n",
        "        start_row += 2\n",
        "\n",
        "        table_df = item['Table']\n",
        "\n",
        "        # Define styles\n",
        "        header_fill = PatternFill(start_color=HEADER_COLOR, end_color=HEADER_COLOR, fill_type=\"solid\")\n",
        "        header_font = Font(bold=True, color=\"FFFFFF\", size=11)\n",
        "        subheader_fill = PatternFill(start_color=SUBHEADER_COLOR, end_color=SUBHEADER_COLOR, fill_type=\"solid\")\n",
        "        subheader_font = Font(bold=True, color=\"FFFFFF\", size=10)\n",
        "        total_fill = PatternFill(start_color=TOTAL_COLOR, end_color=TOTAL_COLOR, fill_type=\"solid\")\n",
        "        total_font = Font(bold=True, size=11)\n",
        "        border = Border(\n",
        "            left=Side(style='thin'),\n",
        "            right=Side(style='thin'),\n",
        "            top=Side(style='thin'),\n",
        "            bottom=Side(style='thin')\n",
        "        )\n",
        "\n",
        "        # For grid tables\n",
        "        if item['Type'] == 'Grid (2D)':\n",
        "            col_idx = 1\n",
        "\n",
        "            cell = ws.cell(row=start_row, column=col_idx, value='Session Name')\n",
        "            cell.font = header_font\n",
        "            cell.fill = header_fill\n",
        "            cell.border = border\n",
        "            cell.alignment = Alignment(horizontal='center', vertical='center', wrap_text=True)\n",
        "            col_idx += 1\n",
        "\n",
        "            for col_name in table_df.columns[1:]:\n",
        "                if ' (Count)' in col_name or (col_name != 'Total' and not any(kw in col_name for kw in [' (Count)', ' (%)'])):\n",
        "                    category = col_name.replace(' (Count)', '').replace(' (%)', '')\n",
        "                    if col_name not in table_df.columns or table_df.columns[table_df.columns.tolist().index(col_name) + 1].endswith('%'):\n",
        "                        merge_range = f'{get_column_letter(col_idx)}{start_row}:{get_column_letter(col_idx + 1)}{start_row}'\n",
        "                        try:\n",
        "                            ws.merge_cells(merge_range)\n",
        "                            col_idx += 2\n",
        "                        except:\n",
        "                            col_idx += 1\n",
        "                    cell = ws.cell(row=start_row, column=col_idx - (2 if '(Count)' in col_name else 1), value=category)\n",
        "                    cell.font = header_font\n",
        "                    cell.fill = header_fill\n",
        "                    cell.border = border\n",
        "                    cell.alignment = Alignment(horizontal='center', vertical='center', wrap_text=True)\n",
        "                elif col_name == 'Total':\n",
        "                    cell = ws.cell(row=start_row, column=col_idx, value='Total')\n",
        "                    cell.font = header_font\n",
        "                    cell.fill = header_fill\n",
        "                    cell.border = border\n",
        "                    cell.alignment = Alignment(horizontal='center', vertical='center', wrap_text=True)\n",
        "                    col_idx += 1\n",
        "\n",
        "            start_row += 1\n",
        "\n",
        "            for r_idx, row in enumerate(table_df.itertuples(index=False, name=None)):\n",
        "                is_total = (r_idx == len(table_df) - 1)\n",
        "\n",
        "                for c_idx, value in enumerate(row):\n",
        "                    cell = ws.cell(row=start_row + r_idx, column=c_idx + 1, value=value)\n",
        "                    cell.border = border\n",
        "                    cell.alignment = Alignment(wrap_text=True, vertical='top', horizontal='left')\n",
        "\n",
        "                    if is_total:\n",
        "                        cell.font = total_font\n",
        "                        cell.fill = total_fill\n",
        "        else:\n",
        "            # For simple and theme tables\n",
        "            for c_idx, col_name in enumerate(table_df.columns):\n",
        "                cell = ws.cell(row=start_row, column=c_idx + 1, value=col_name)\n",
        "                cell.font = header_font\n",
        "                cell.fill = header_fill\n",
        "                cell.border = border\n",
        "                cell.alignment = Alignment(horizontal='center', vertical='center', wrap_text=True)\n",
        "\n",
        "            start_row += 1\n",
        "\n",
        "            for r_idx, row in enumerate(table_df.itertuples(index=False, name=None)):\n",
        "                is_total = (r_idx == len(table_df) - 1)\n",
        "\n",
        "                for c_idx, value in enumerate(row):\n",
        "                    cell = ws.cell(row=start_row + r_idx, column=c_idx + 1, value=value)\n",
        "                    cell.border = border\n",
        "                    cell.alignment = Alignment(wrap_text=True, vertical='top', horizontal='left')\n",
        "\n",
        "                    if is_total:\n",
        "                        cell.font = total_font\n",
        "                        cell.fill = total_fill\n",
        "\n",
        "        start_row += len(table_df) + 2\n",
        "\n",
        "        # Add insights\n",
        "        ws[f'A{start_row}'] = \"KEY INSIGHTS:\"\n",
        "        ws[f'A{start_row}'].font = Font(bold=True, underline='single')\n",
        "        start_row += 1\n",
        "\n",
        "        insight_lines = item['Insights'].split('\\n')\n",
        "        for line in insight_lines:\n",
        "            if line.strip():\n",
        "                ws[f'A{start_row}'] = line\n",
        "                ws[f'A{start_row}'].alignment = Alignment(wrap_text=True, vertical='top', horizontal='left')\n",
        "                start_row += 1\n",
        "\n",
        "        start_row += 2\n",
        "\n",
        "    # Adjust column widths for all sheets\n",
        "    for sheet in writer.book.sheetnames:\n",
        "        ws = writer.book[sheet]\n",
        "        for col in ws.columns:\n",
        "            max_length = 0\n",
        "            col_letter = col[0].column_letter\n",
        "\n",
        "            for cell in col:\n",
        "                try:\n",
        "                    if cell.value:\n",
        "                        cell_length = len(str(cell.value))\n",
        "                        max_length = max(max_length, cell_length)\n",
        "                except:\n",
        "                    pass\n",
        "\n",
        "            adjusted_width = min(max_length + 2, MAX_COLUMN_WIDTH)\n",
        "            ws.column_dimensions[col_letter].width = max(adjusted_width, MIN_COLUMN_WIDTH)\n",
        "\n",
        "print(f\"✓ Complete analysis saved to: {excel_file_name}\")\n"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "nEz9c_RkQpDH",
        "outputId": "fc804653-707e-4d08-d7ee-3aacfd15f919"
      },
      "outputs": [
        {
          "name": "stdout",
          "output_type": "stream",
          "text": [
            "\n",
            "======================================================================================================================================================\n",
            "COST ANALYSIS BY QUESTION/COLUMN\n",
            "======================================================================================================================================================\n",
            "\n",
            "======================================================================================================================================================\n",
            "API COST BREAKDOWN (BY QUESTION/COLUMN)\n",
            "======================================================================================================================================================\n",
            "\n",
            "✓ ACTUAL MODEL USED: gpt-3.5-turbo\n",
            "\n",
            "Question/Column                                                                  | Operations                          | # Calls  | Input        | Output       | Cost (USD)  \n",
            "------------------------------------------------------------------------------------------------------------------------------------------------------\n",
            "Recently there was a panel session conducted with Swami, Maa and a Poornanga. Ho | Insights - Simple Questions         | 1        | 83           | 218          | $0.000369   \n",
            "What is the one key takeaway you got from the Poornanga panel session?           | Extract Themes, Assign Themes       | 239      | 49272        | 1860         | $0.027426   \n",
            "What key aspects would you talk about or ask them - in the Sadhanapada alumni pa | Extract Themes, Assign Themes       | 70       | 39234        | 755          | $0.020749   \n",
            "Would you like to engage in a discussion about how life is after Sadhanapada wit | Insights - Simple Questions         | 1        | 63           | 155          | $0.000264   \n",
            "[Themes] What is the one key takeaway you got from the Poornanga panel session?  | Insights - Theme Columns            | 1        | 115          | 230          | $0.000403   \n",
            "[Themes] What key aspects would you talk about or ask them - in the Sadhanapada  | Insights - Theme Columns            | 1        | 147          | 200          | $0.000374   \n",
            "------------------------------------------------------------------------------------------------------------------------------------------------------\n",
            "TOTAL                                                                            |                                     | 313      | 88914        | 3418         | $0.049584   \n",
            "======================================================================================================================================================\n",
            "\n",
            "==================================================================================================================================\n",
            "COST ANALYSIS BY OPERATION\n",
            "==================================================================================================================================\n",
            "\n",
            "==================================================================================================================================\n",
            "API USAGE & COST SUMMARY (BY OPERATION)\n",
            "==================================================================================================================================\n",
            "\n",
            "✓ ACTUAL MODEL USED: gpt-3.5-turbo\n",
            "\n",
            "Operation                                | # Calls    | Input Tokens    | Output Tokens   | Cost (USD)  \n",
            "----------------------------------------------------------------------------------------------------------------------------------\n",
            "Assign Themes                            | 278        | 38377           | 2076            | $0.022302   \n",
            "Extract Themes                           | 31         | 50129           | 539             | $0.025873   \n",
            "Insights - Simple Questions              | 2          | 146             | 373             | $0.000633   \n",
            "Insights - Theme Columns                 | 2          | 262             | 430             | $0.000776   \n",
            "----------------------------------------------------------------------------------------------------------------------------------\n",
            "TOTAL                                    | 313        | 88914           | 3418            | $0.049584   \n",
            "==================================================================================================================================\n",
            "\n",
            "==================================================================================================================================\n",
            "PROJECTED COSTS FOR ALL MODELS (based on actual token usage)\n",
            "==================================================================================================================================\n",
            "Model Name                | Input ($/1M)    | Output ($/1M)   | Projected Cost  | Status         \n",
            "----------------------------------------------------------------------------------------------------------------------------------\n",
            "gpt-3.5-turbo             | $0.50           | $1.50           | $0.049584       | ✓ ACTUAL       \n",
            "gpt-4o                    | $5.00           | $15.00          | $0.495840       | Projected      \n",
            "gpt-4o-mini               | $0.15           | $0.60           | $0.015388       | Projected      \n",
            "==================================================================================================================================\n",
            "\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# Cost analysis\n",
        "# ============================================================================\n",
        "\n",
        "print(\"\\n\" + \"=\"*150)\n",
        "print(\"COST ANALYSIS BY QUESTION/COLUMN\")\n",
        "print(\"=\"*150)\n",
        "cost_tracker.summary_by_question()\n",
        "\n",
        "print(\"=\"*130)\n",
        "print(\"COST ANALYSIS BY OPERATION\")\n",
        "print(\"=\"*130)\n",
        "cost_tracker.summary()"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 34
        },
        "id": "wSRgkNEouoIA",
        "outputId": "c25223b7-a3ea-46c9-f8e6-72c1e2728915"
      },
      "outputs": [
        {
          "data": {
            "application/javascript": [
              "\n",
              "    async function download(id, filename, size) {\n",
              "      if (!google.colab.kernel.accessAllowed) {\n",
              "        return;\n",
              "      }\n",
              "      const div = document.createElement('div');\n",
              "      const label = document.createElement('label');\n",
              "      label.textContent = `Downloading \"${filename}\": `;\n",
              "      div.appendChild(label);\n",
              "      const progress = document.createElement('progress');\n",
              "      progress.max = size;\n",
              "      div.appendChild(progress);\n",
              "      document.body.appendChild(div);\n",
              "\n",
              "      const buffers = [];\n",
              "      let downloaded = 0;\n",
              "\n",
              "      const channel = await google.colab.kernel.comms.open(id);\n",
              "      // Send a message to notify the kernel that we're ready.\n",
              "      channel.send({})\n",
              "\n",
              "      for await (const message of channel.messages) {\n",
              "        // Send a message to notify the kernel that we're ready.\n",
              "        channel.send({})\n",
              "        if (message.buffers) {\n",
              "          for (const buffer of message.buffers) {\n",
              "            buffers.push(buffer);\n",
              "            downloaded += buffer.byteLength;\n",
              "            progress.value = downloaded;\n",
              "          }\n",
              "        }\n",
              "      }\n",
              "      const blob = new Blob(buffers, {type: 'application/binary'});\n",
              "      const a = document.createElement('a');\n",
              "      a.href = window.URL.createObjectURL(blob);\n",
              "      a.download = filename;\n",
              "      div.appendChild(a);\n",
              "      a.click();\n",
              "      div.remove();\n",
              "    }\n",
              "  "
            ],
            "text/plain": [
              "<IPython.core.display.Javascript object>"
            ]
          },
          "metadata": {},
          "output_type": "display_data"
        },
        {
          "data": {
            "application/javascript": [
              "download(\"download_60d0068f-850d-448e-a532-81916e636c9c\", \"Poornanaga + SP alumni panel session survey_analysis.xlsx\", 16414)"
            ],
            "text/plain": [
              "<IPython.core.display.Javascript object>"
            ]
          },
          "metadata": {},
          "output_type": "display_data"
        },
        {
          "name": "stdout",
          "output_type": "stream",
          "text": [
            "✓ Analysis file ready for download\n"
          ]
        }
      ],
      "source": [
        "# ============================================================================\n",
        "# Download results\n",
        "# ============================================================================\n",
        "\n",
        "files.download(excel_file_name)\n",
        "print(\"✓ Analysis file ready for download\")"
      ]
    }
  ],
  "metadata": {
    "colab": {
      "provenance": []
    },
    "kernelspec": {
      "display_name": "Python 3",
      "name": "python3"
    },
    "language_info": {
      "name": "python"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 0
}
